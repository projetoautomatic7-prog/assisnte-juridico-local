name: ðŸ¤– Auto Create Issues from Code Comments

on:
  push:
    branches:
      - main
      - develop
  # Removido pull_request para evitar erros de diff em PRs
  schedule:
    # Executa a cada 6 horas (00:00, 06:00, 12:00, 18:00 UTC)
    - cron: "0 */6 * * *"
  workflow_dispatch: # Permite executar manualmente

permissions:
  issues: write
  contents: read
  pull-requests: read

jobs:
  auto-create-issues:
    name: Scan and Create Issues
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ” Scan for TODO/FIXME/etc
        id: scan
        uses: alstr/todo-to-issue-action@v4
        with:
          # Criar issues automaticamente
          AUTO_ASSIGN: true

          # Labels automÃ¡ticas - INCLUI auto-copilot para delegaÃ§Ã£o automÃ¡tica!
          LABEL: "auto-created,needs-triage,auto-copilot"

          # Fechar issues quando TODO Ã© removido
          CLOSE_ISSUES: true

          # Idioma portuguÃªs
          ISSUE_TEMPLATE: |
            **Detectado automaticamente no cÃ³digo**

            ðŸ“ **Arquivo**: `{{ FILE_PATH }}`
            ðŸ“ **Linha**: {{ LINE_NUMBER }}
            ðŸ·ï¸ **Tipo**: {{ TODO_TYPE }}

            ---

            ### ðŸ“ ComentÃ¡rio Original

            ```{{ LANGUAGE }}
            {{ COMMENT }}
            ```

            ---

            ### ðŸ”— Links Ãšteis

            - [Ver no cÃ³digo]({{ PERMALINK }})
            - [Ver diff]({{ DIFF_URL }})

            ---

            ðŸ¤– *Issue criado automaticamente pelo workflow Auto Create Issues*

      - name: ðŸ“Š Summary
        if: steps.scan.outputs.issues_created > 0
        run: |
          echo "âœ… ${{ steps.scan.outputs.issues_created }} issue(s) criado(s) automaticamente!"
          echo "ðŸ”— Veja em: https://github.com/${{ github.repository }}/issues"
