
VocÃª disse:
Imagem carregada
analise os prints pra min
O ChatGPT disse:
Perfeito, os prints dÃ£o bastante material. Vou analisar como auditoria funcional + UX tÃ©cnica, nÃ£o sÃ³ estÃ©tica.

1ï¸âƒ£ VisÃ£o geral do que vocÃª jÃ¡ construiu
O que aparece nos prints mostra claramente que vocÃª jÃ¡ estÃ¡ num nÃ­vel avanÃ§ado:

Arquitetura de app jurÃ­dico modular

SeparaÃ§Ã£o clara entre:

Dashboard

Minutas

Agentes de IA

Acervo PJe / CRM

Interface moderna, limpa, consistente (padrÃ£o SaaS)

Uso correto de modais, cards, status badges e empty states

IntegraÃ§Ã£o pensada para:

OCR (importaÃ§Ã£o por imagem)

IA generativa (Gemini 2.5 Pro)

AutomaÃ§Ã£o futura (PJe real)

Em resumo: isso nÃ£o parece um MVP amador, parece um produto em estÃ¡gio beta avanÃ§ado.

Agora vamos aos pontos finos.

2ï¸âƒ£ Editor de Minutas â€“ AnÃ¡lise profunda
âœ… Pontos muito bons
1. Fluxo estÃ¡ correto

Lista de minutas â†’ botÃ£o â€œNova Minutaâ€ â†’ modal

Editor rico isolado dentro do modal (bom para foco)

2. Estrutura lÃ³gica correta

TÃ­tulo

Tipo

Status

VinculaÃ§Ã£o a processo

Editor com toolbar completa

Isso espelha exatamente a lÃ³gica mental de um advogado.

3. Toolbar

Bem completa

Ãcones coerentes

JÃ¡ transmite sensaÃ§Ã£o de â€œWord jurÃ­dico + IAâ€

âš ï¸ Pontos de melhoria (importantes)
ğŸ”´ Problema 1: Modal grande + toolbar flutuante
No primeiro print:

O modal estÃ¡ grande

A toolbar do editor estÃ¡ flutuando sem contexto visual claro

DÃ¡ sensaÃ§Ã£o de â€œelemento soltoâ€

ğŸ‘‰ Risco real: usuÃ¡rio nÃ£o entende imediatamente onde comeÃ§a/termina a Ã¡rea editÃ¡vel.

SugestÃ£o tÃ©cnica (UX):

Delimitar o editor com:

Borda sutil

Fundo levemente diferente

Toolbar fixa no topo do editor, nÃ£o solta

Isso aproxima ainda mais do Google Docs / Word.

ğŸ”´ Problema 2: Falta hierarquia visual entre campos e editor
Hoje:

TÃ­tulo, tipo, status e editor estÃ£o no mesmo â€œpeso visualâ€

Mas mentalmente o advogado pensa:

â€œPreencho metadados â†’ depois escrevoâ€

SugestÃ£o:

Criar um bloco visual:

ğŸ”¹ â€œDados da Minutaâ€

ğŸ”¹ â€œConteÃºdoâ€

Mesmo sem mudar layout, sÃ³ com espaÃ§amento e tipografia isso melhora muito.

ğŸ”´ Problema 3: Falta CTA de IA explÃ­cito no editor
VocÃª tem IA ativa, mas no editor isso nÃ£o salta aos olhos.

Hoje parece:

Editor tradicional

IA â€œescondidaâ€ nos comandos

SugestÃµes objetivas:

BotÃ£o visÃ­vel tipo:

âœ¨ â€œGerar com IAâ€

ğŸ§  â€œCompletar minutaâ€

Placeholder inteligente no editor:

â€œDigite ou use a IA para gerar sua minutaâ€¦â€

Isso aumenta muito o valor percebido.

3ï¸âƒ£ Lista de Minutas (Empty State)
O segundo print estÃ¡ muito bem resolvido.

âœ… Pontos fortes
Ãcone central

Texto claro

CTA explÃ­cito (â€œNova Minutaâ€)

Isso estÃ¡ no padrÃ£o de produtos grandes (Notion, Linear, etc.).

SugestÃ£o pequena
VocÃª pode enriquecer com exemplos:

â€œEx: PetiÃ§Ã£o Inicial, ContestaÃ§Ã£o, Recursoâ€¦â€

Ajuda usuÃ¡rios menos experientes.

4ï¸âƒ£ Dashboard â€“ AnÃ¡lise funcional
Aqui vocÃª mandou muito bem.

âœ… O que estÃ¡ excelente
1. Cards de mÃ©tricas

Processos ativos

ConcluÃ­dos

Prazos

Urgentes

Isso Ã© exatamente o que advogado quer ver primeiro.

2. EstatÃ­sticas de agentes

Total de execuÃ§Ãµes

Taxa de sucesso

Tempo mÃ©dio

Cobertura hÃ­brida

ğŸ‘‰ Isso diferencia seu sistema de qualquer software jurÃ­dico tradicional.

3. ImportaÃ§Ã£o por imagem

Modal claro

Passo 1 â†’ upload

Passo 2 â†’ dados extraÃ­dos

Excelente para OCR + IA.

âš ï¸ Pontos de atenÃ§Ã£o no Dashboard
ğŸ”´ Problema 4: â€œPJe Desconectadoâ€ pouco explorado
O badge â€œPJe Desconectadoâ€ aparece, mas:

NÃ£o explica impacto

NÃ£o orienta aÃ§Ã£o

SugestÃ£o:

Tooltip ou clique:

â€œConecte o PJe para sincronizaÃ§Ã£o automÃ¡tica de processos e intimaÃ§Ãµesâ€

Isso reduz frustraÃ§Ã£o.

ğŸ”´ Problema 5: MÃ©tricas zeradas sem contexto
Tudo zerado Ã© normal no inÃ­cio, mas pode gerar sensaÃ§Ã£o de â€œnÃ£o funcionaâ€.

SoluÃ§Ã£o simples (UX):

Texto auxiliar:

â€œAs mÃ©tricas aparecem apÃ³s as primeiras execuÃ§Ãµes dos agentesâ€

Isso muda totalmente a percepÃ§Ã£o.

5ï¸âƒ£ Arquitetura implÃ­cita (muito importante)
Pelos prints, dÃ¡ para inferir que vocÃª acertou em cheio na arquitetura:

Frontend independente

Backend/IA desacoplados

OCR como serviÃ§o

Agentes hÃ­bridos (manual + automÃ¡tico)

Preparado para:

RobÃ´ PJe real

AutomaÃ§Ã£o 24/7

Zero intervenÃ§Ã£o humana

Isso estÃ¡ alinhado com Legal Ops moderno, nÃ£o sÃ³ advocacia tradicional.

6ï¸âƒ£ DiagnÃ³stico final (bem direto)
O que vocÃª jÃ¡ tem
âœ” Produto real
âœ” UX acima da mÃ©dia
âœ” Conceito forte
âœ” Diferencial claro (IA + automaÃ§Ã£o)

O que falta para â€œnÃ­vel profissional mÃ¡ximoâ€
ğŸ”§ Refinar hierarquia visual
ğŸ”§ Tornar a IA mais explÃ­cita no editor
ğŸ”§ Guiar melhor o usuÃ¡rio iniciante
ğŸ”§ Pequenos ajustes de feedback visual

Nada disso exige refazer cÃ³digo pesado â€” Ã© 90% ajuste fino de UX/UI.

PrÃ³ximo passo lÃ³gico
O prÃ³ximo salto de qualidade seria:

Transformar o Editor de Minutas no â€œcoraÃ§Ã£oâ€ do sistema

Fazer ele parecer:

â€œUm Google Docs jurÃ­dico operado por agentes de IAâ€

Quando quiser, posso:

Desenhar o fluxo ideal do editor

Sugerir componentes exatos (React + UI)

Ou montar um checklist de UX final para produÃ§Ã£o

O que vocÃª construiu jÃ¡ merece isso.

VocÃª disse:
vou colar os arquivos aqui para corrigir analisar pra min, quais arquivos tenho que colar aqui?
O ChatGPT disse:
Excelente pergunta â€” e dÃ¡ pra organizar isso de forma cirÃºrgica, sem vocÃª perder tempo colando coisa desnecessÃ¡ria.

Vou te dizer exatamente quais arquivos preciso, em ordem de prioridade, e por quÃª.
Segue isso e a anÃ¡lise fica objetiva, tÃ©cnica e aproveitÃ¡vel direto no cÃ³digo.

ğŸ¯ OBJETIVO DA ANÃLISE
Corrigir, refinar e elevar:

Editor de Minutas

Modal de criaÃ§Ã£o

Dashboard / ImportaÃ§Ã£o por imagem

Fluxo de IA (Gemini)

UX + arquitetura React

ğŸ¥‡ PRIORIDADE MÃXIMA (cole primeiro)
1ï¸âƒ£ Componente do Editor de Minutas
ğŸ“Œ Normalmente algo como:

src/pages/minutas/EditorMinutas.tsx
ou

src/components/minutas/MinutaEditor.tsx
ğŸ‘‰ Esse arquivo controla:

Toolbar

Editor rico

IntegraÃ§Ã£o com IA

Estado da minuta

Sem ele, nÃ£o dÃ¡ para corrigir o coraÃ§Ã£o do sistema.

2ï¸âƒ£ Modal Nova Minuta
ğŸ“Œ Algo como:

src/components/minutas/NovaMinutaModal.tsx
ğŸ‘‰ Aqui estÃ£o:

Campos (tÃ­tulo, tipo, status)

BotÃ£o â€œCriar Minutaâ€

LÃ³gica de abertura/fechamento

UX do modal

Esse arquivo Ã© onde estÃ£o os problemas de:

Hierarquia visual

ExperiÃªncia inicial

ğŸ¥ˆ PRIORIDADE ALTA
3ï¸âƒ£ PÃ¡gina de listagem de Minutas
ğŸ“Œ Exemplo:

src/pages/minutas/index.tsx
ğŸ‘‰ Serve para:

Ajustar empty state

Melhorar filtros

Refinar UX geral

4ï¸âƒ£ Componente de Dashboard
ğŸ“Œ Exemplo:

src/pages/dashboard/index.tsx
ğŸ‘‰ Aqui analisamos:

Cards

MÃ©tricas

Status â€œPJe desconectadoâ€

Feedback visual de dados zerados

ğŸ¥‰ PRIORIDADE MÃ‰DIA (se existir)
5ï¸âƒ£ Modal de ImportaÃ§Ã£o por Imagem (OCR)
ğŸ“Œ Algo como:

src/components/import/ImportarProcessoImagem.tsx
ğŸ‘‰ Serve para:

UX do OCR

Fluxo passo-a-passo

PreparaÃ§Ã£o para automaÃ§Ã£o total

6ï¸âƒ£ Hooks ou serviÃ§os de IA (Gemini)
ğŸ“Œ Exemplo:

src/lib/ai/gemini.ts
ou

src/services/ai.ts
ğŸ‘‰ Aqui eu verifico:

Acoplamento correto

Possibilidade de agentes autÃ´nomos

SeguranÃ§a e escalabilidade

ğŸš« NÃƒO COLE AGORA (a menos que eu peÃ§a)
package.json

vite.config.ts

CSS global

Tailwind config

Rotas gerais

Esses sÃ³ entram depois, se surgir problema estrutural.

âœ… ORDEM IDEAL PARA COLAR AQUI
Editor de Minutas (arquivo principal)

Modal Nova Minuta

PÃ¡gina de Minutas

Dashboard

Modal OCR

ServiÃ§os de IA

Pode colar um arquivo por mensagem ou vÃ¡rios pequenos juntos.

ğŸ§  O QUE EU VOU ENTREGAR EM TROCA
Para cada arquivo:

AnÃ¡lise tÃ©cnica linha por linha

CorreÃ§Ãµes prontas pra colar

Melhorias de UX aplicadas no cÃ³digo

Ajustes pensando em:

AutomaÃ§Ã£o 24/7

Agentes de IA

IntegraÃ§Ã£o futura com PJe real

VocÃª jÃ¡ construiu a base de um software sÃ©rio.
Agora Ã© lapidaÃ§Ã£o profissional.

Quando quiser, pode colar o primeiro arquivo (Editor de Minutas).

O ChatGPT disse:
Manda assim, que funciona 100% e nÃ£o te faz perder tempo:

1) Cole primeiro (obrigatÃ³rios)
PÃ¡gina/Componente do Editor de Minutas (TSX)

o arquivo que renderiza o â€œEditor de Minutasâ€ e a toolbar (TipTap/Quill/etc)

normalmente algo como src/pages/minutas/* ou src/components/minutas/*

Modal â€œNova Minutaâ€ (TSX)

o arquivo que abre aquele modal com â€œEditor / Templates / VariÃ¡veisâ€, campos e botÃ£o â€œCriar Minutaâ€

âœ… SÃ³ com esses 2 eu jÃ¡ consigo corrigir: layout do modal, hierarquia visual, toolbar â€œsoltaâ€, CTA de IA, etc.

2) Depois (pra fechar o fluxo de ponta a ponta)
PÃ¡gina de listagem de Minutas (TSX)

onde tem busca, filtros â€œTodos Status/Tiposâ€, empty state â€œNenhuma minutaâ€¦â€

Arquivo de serviÃ§os/hooks das minutas (TS/TSX)

onde vocÃª cria/salva minutas (localStorage/DB/API)

ex: src/lib/minutas.ts, src/hooks/use-minutas.ts, src/services/minutas.ts

3) Se vocÃª quiser que eu analise o Dashboard tambÃ©m
PÃ¡gina do Dashboard (TSX)

Modal â€œImportar Processo via Screenshot/Imagemâ€ (TSX)

ServiÃ§o/hook do OCR/IA (TS) (onde chama Gemini/extraÃ§Ã£o)

4) Como colar aqui (pra eu nÃ£o me perder)
Cole um arquivo por mensagem, comeÃ§ando pelo Editor de Minutas.

Em cima do conteÃºdo, escreva sÃ³ a linha:
// FILE: src/.../NomeDoArquivo.tsx

Assim eu te devolvo o arquivo inteiro jÃ¡ corrigido pronto pra colar.

Pode mandar agora o Editor de Minutas primeiro.

VocÃª disse:
# ğŸ“‹ AnÃ¡lise Completa - Assistente JurÃ­d.ts
TypeScript
segue
O ChatGPT disse:

Pensou por 43s
Recebi sim âœ… â€” vocÃª mandou um arquivo consolidado (# ğŸ“‹ AnÃ¡lise Completa - Assistente JurÃ­d.ts) com vÃ¡rios componentes dentro (MinutasManager, ProfessionalEditor, Dashboard, OCR, gemini-service, hooks etc.). Isso jÃ¡ dÃ¡ pra comeÃ§ar a corrigir bastante coisa sem vocÃª colar tudo separado.

SÃ³ um aviso rÃ¡pido: alguns arquivos antigos que vocÃª tinha enviado em outras conversas expiraram aqui no sistema. Se vocÃª quiser que eu compare com versÃµes antigas, vai precisar reenviar â€” mas esse consolidado atual estÃ¡ OK.

O que eu preciso de vocÃª agora (pra eu corrigir â€œde verdadeâ€)
VocÃª tem duas opÃ§Ãµes:

OpÃ§Ã£o A) Continuar pelo arquivo consolidado (mais rÃ¡pido agora)
Eu vou trabalhar em cima do que estÃ¡ dentro desse .ts e te devolvo patches/diffs (trechos prontos pra substituir).

âœ… Para isso, me diga sÃ³:

VocÃª quer usar qual editor como principal?

ProfessionalEditor (CKEditor 5) OU

TiptapEditorV2 (TipTap)

(Pelos prints, parece que vocÃª estÃ¡ usando o ProfessionalEditor no modal.)

Se vocÃª nÃ£o quiser responder, eu assumo ProfessionalEditor como principal e sigo.

OpÃ§Ã£o B) Colar os arquivos â€œreaisâ€ do repositÃ³rio (melhor e mais preciso)
AÃ­ eu te devolvo o arquivo inteiro pronto pra colar (como vocÃª gosta), sem risco de divergÃªncia.

Cole exatamente estes 4 (nessa ordem):

src/components/MinutasManager.tsx âœ… (obrigatÃ³rio)

src/components/editors/ProfessionalEditor.tsx ou src/components/editors/TiptapEditorV2.tsx âœ… (obrigatÃ³rio)

src/pages/Dashboard.tsx (ou onde estÃ¡ o dashboard)

src/components/PjeImageImporter.tsx (OCR)

Enquanto isso: jÃ¡ achei 4 correÃ§Ãµes importantes no seu Modal â€œNova Minutaâ€ (MinutasManager)
Vou ser direto e Ãºtil: no trecho do modal que vocÃª mandou, tem pontos que explicam exatamente o â€œestranhoâ€ dos prints.

1) DialogContent + Tabs com overflow conflitando
VocÃª usa:

DialogContent ... overflow-y-auto
e ao mesmo tempo

Tabs ... overflow-hidden

TabsContent ... overflow-hidden

ğŸ‘‰ Isso costuma gerar: scroll do modal brigando com scroll interno, toolbar parecendo â€œflutuarâ€, e sensaÃ§Ã£o de UI â€œsoltaâ€.

âœ… Ajuste recomendado:

Deixe o DialogContent sem overflow-y-auto

Coloque um ScrollArea sÃ³ na Ã¡rea de conteÃºdo abaixo do header/tabs.

2) Grid rÃ­gido grid-cols-4 nos metadados
No modal, os campos ficam apertados dependendo da largura, e a hierarquia visual fica â€œtudo igualâ€.

âœ… Melhor:

Responsivo: grid-cols-1 md:grid-cols-4

Separar â€œDados da Minutaâ€ vs â€œConteÃºdoâ€

3) â€œVincular a Processoâ€: valor _none fica salvo errado
VocÃª tem:

<SelectItem value="_none">Nenhum</SelectItem>
onValueChange={(value) => setFormData({ ...formData, processId: value })}
Isso salva processId="_none" (lixo semÃ¢ntico).

âœ… Melhor:

Guardar "" ou null

Transformar no onValueChange

4) Select de Tipo/Status sem placeholder
VocÃª estÃ¡ com:

<SelectValue />
Sem placeholder, o campo fica vazio/estranho quando formData.tipo ainda nÃ£o foi escolhido.

âœ… Melhor:

<SelectValue placeholder="Selecione..." />
Patch pronto (trecho para vocÃª aplicar no MinutasManager)
Abaixo vai um patch sÃ³ do bloco do Modal (nÃ£o o arquivo inteiro). Se vocÃª estiver seguindo a OpÃ§Ã£o A (consolidado), vocÃª consegue encaixar esse trecho.

<Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
  <DialogTrigger asChild>
    <Button
      onClick={() => {
        setEditingMinuta(null);
        resetForm();
      }}
    >
      <Plus className="mr-2" />
      Nova Minuta
    </Button>
  </DialogTrigger>

  {/* âœ… Removi overflow-y-auto do DialogContent e deixei scroll controlado */}
  <DialogContent className="max-w-6xl max-h-[95vh] flex flex-col bg-card p-0 overflow-hidden">
    <div className="p-6 pb-3">
      <DialogHeader>
        <DialogTitle className="flex items-center gap-2">
          {editingMinuta ? (
            <>
              <Pencil />
              Editar Minuta
            </>
          ) : (
            <>
              <Plus />
              Nova Minuta
            </>
          )}
        </DialogTitle>
        <DialogDescription>
          Use o editor rico para criar sua minuta. Use a IA para gerar conteÃºdo com Gemini 2.5 Pro.
        </DialogDescription>
      </DialogHeader>
    </div>

    <Tabs
      value={activeTab}
      onValueChange={setActiveTab}
      className="flex-1 flex flex-col overflow-hidden"
    >
      <div className="px-6">
        <TabsList className="grid w-full grid-cols-3">
          <TabsTrigger value="editor">Editor</TabsTrigger>
          <TabsTrigger value="templates">Templates</TabsTrigger>
          <TabsTrigger value="variaveis">VariÃ¡veis</TabsTrigger>
        </TabsList>
      </div>

      {/* âœ… ScrollArea sÃ³ no conteÃºdo */}
      <div className="flex-1 overflow-hidden">
        <ScrollArea className="h-full">
          <div className="px-6 pb-6 pt-4">
            <TabsContent value="editor" className="mt-0 space-y-4">
              {/* âœ… Bloco â€œDados da minutaâ€ com grid responsivo */}
              <Card className="border-muted">
                <CardHeader className="py-4">
                  <CardTitle className="text-sm">Dados da minuta</CardTitle>
                  <CardDescription className="text-xs">
                    Defina tÃ­tulo, tipo, status e vinculaÃ§Ã£o (opcional)
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div className="md:col-span-2">
                      <Label htmlFor="titulo">TÃ­tulo</Label>
                      <Input
                        id="titulo"
                        value={formData.titulo}
                        onChange={(e) => setFormData({ ...formData, titulo: e.target.value })}
                        placeholder="Ex: PetiÃ§Ã£o Inicial - AÃ§Ã£o de CobranÃ§a"
                      />
                    </div>

                    <div>
                      <Label htmlFor="tipo">Tipo</Label>
                      <Select
                        value={formData.tipo}
                        onValueChange={(value) =>
                          setFormData({ ...formData, tipo: value as Minuta["tipo"] })
                        }
                      >
                        <SelectTrigger id="tipo">
                          <SelectValue placeholder="Selecione..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="peticao">PetiÃ§Ã£o</SelectItem>
                          <SelectItem value="contrato">Contrato</SelectItem>
                          <SelectItem value="parecer">Parecer</SelectItem>
                          <SelectItem value="recurso">Recurso</SelectItem>
                          <SelectItem value="procuracao">ProcuraÃ§Ã£o</SelectItem>
                          <SelectItem value="outro">Outro</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <Label htmlFor="status">Status</Label>
                      <Select
                        value={formData.status}
                        onValueChange={(value) =>
                          setFormData({ ...formData, status: value as Minuta["status"] })
                        }
                      >
                        <SelectTrigger id="status">
                          <SelectValue placeholder="Selecione..." />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="rascunho">Rascunho</SelectItem>
                          <SelectItem value="em-revisao">Em RevisÃ£o</SelectItem>
                          <SelectItem value="finalizada">Finalizada</SelectItem>
                          <SelectItem value="arquivada">Arquivada</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  <div>
                    <Label htmlFor="processo">Vincular a Processo (opcional)</Label>
                    <Select
                      value={formData.processId || ""}
                      onValueChange={(value) =>
                        setFormData({ ...formData, processId: value === "_none" ? "" : value })
                      }
                    >
                      <SelectTrigger id="processo">
                        <SelectValue placeholder="Selecione um processo" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="_none">Nenhum</SelectItem>
                        {(processes || []).map((p) => (
                          <SelectItem key={p.id} value={p.id}>
                            {p.numeroCNJ} - {p.titulo}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                </CardContent>
              </Card>

              {/* ConteÃºdo */}
              <Card className="border-muted">
                <CardHeader className="py-4">
                  <CardTitle className="text-sm">ConteÃºdo</CardTitle>
                  <CardDescription className="text-xs">
                    Escreva ou gere com IA e depois refine com comandos
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="min-h-[420px]">
                    <ProfessionalEditor
                      key={editingMinuta?.id || "new-minuta"}
                      content={formData.conteudo}
                      onChange={(content) => setFormData({ ...formData, conteudo: content })}
                      onAIGenerate={handleAIGenerate}
                      onAIStream={handleAIStream}
                      variables={variableValues}
                      placeholder="Digite o conteÃºdo da minuta ou use a IA para gerar com Gemini..."
                      className="h-full min-h-[420px]"
                      showCollaboration={false}
                    />
                  </div>
                </CardContent>
              </Card>

              {/* (o Card de Comandos IA pode ficar como estÃ¡ por enquanto) */}
            </TabsContent>
          </div>
        </ScrollArea>
      </div>
    </Tabs>

    <div className="p-6 pt-3 border-t flex justify-end gap-2">
      <Button variant="outline" onClick={() => setIsDialogOpen(false)}>
        Cancelar
      </Button>
      <Button onClick={handleSaveMinuta}>
        {editingMinuta ? "Salvar alteraÃ§Ãµes" : "Criar Minuta"}
      </Button>
    </div>
  </DialogContent>
</Dialog>
PrÃ³ximo passo
Se vocÃª confirmar qual editor vocÃª quer como padrÃ£o (CKEditor ou TipTap), eu jÃ¡ sigo para a prÃ³xima correÃ§Ã£o: CTA de IA â€œvisÃ­velâ€ dentro do editor + â€œtoolbar menos soltaâ€ (isso vai deixar idÃªntico ao que vocÃª quer dos prints).

VocÃª disse:
vou enviar segue : import { Alert, AlertDescription } from "@/components/ui/alert";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { ScrollArea } from "@/components/ui/scroll-area";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useAICommands } from "@/hooks/use-ai-commands";
import { useAIStreaming } from "@/hooks/use-ai-streaming";
import { useGoogleDocs } from "@/hooks/use-google-docs";
import { useKV } from "@/hooks/use-kv";
import {
  documentTemplates,
  extractUnfilledVariables,
  replaceTemplateVariables,
  type DocumentTemplate,
} from "@/lib/document-templates";
import { callGemini, isGeminiConfigured } from "@/lib/gemini-service";
import { googleDocsService } from "@/lib/google-docs-service";
import { themeConfig } from "@/lib/themes";
import {
  createMinuta,
  updateMinuta,
  validateMinutaForFinalization,
  type MinutaInput,
} from "@/services/minuta-service";
import type { Minuta, Process } from "@/types";
import {
  AlertTriangle,
  Bot,
  CheckCircle,
  ChevronDown,
  Clock,
  Copy,
  Download,
  Expand,
  Eye,
  FileText,
  FolderOpen,
  Grid3x3,
  List,
  Loader2,
  Pencil,
  Plus,
  RefreshCw,
  Search,
  Sparkles,
  Trash,
  Wand2,
  Zap,
} from "lucide-react";
import { useCallback, useEffect, useRef, useState } from "react";
import { toast } from "sonner";

import { ProfessionalEditor } from "@/components/editor/ProfessionalEditor";

// Verificar se as credenciais do Google estÃ£o configuradas
const GOOGLE_CLIENT_ID = import.meta.env.VITE_GOOGLE_CLIENT_ID || "";
const GOOGLE_API_KEY = import.meta.env.VITE_GEMINI_API_KEY || "";
const isGoogleConfigured = !!GOOGLE_CLIENT_ID && !!GOOGLE_API_KEY;

type ViewMode = "grid" | "list";

export default function MinutasManager() {
  const [minutas, setMinutas] = useKV<Minuta[]>("minutas", []);
  const [processes] = useKV<Process[]>("processes", []);
  const { exportToGoogleDocs, importFromGoogleDocs, openDocument } = useGoogleDocs();

  const [isDialogOpen, setIsDialogOpen] = useState(false);
  const [editingMinuta, setEditingMinuta] = useState<Minuta | null>(null);
  const [isSyncing, setIsSyncing] = useState<string | null>(null);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [activeTab, setActiveTab] = useState("editor");
  const [searchQuery, setSearchQuery] = useState("");
  const [selectedTemplate, setSelectedTemplate] = useState<DocumentTemplate | null>(null);
  const [variableValues, setVariableValues] = useState<Record<string, string>>({});
  const [filterStatus, setFilterStatus] = useState<string>("all");
  const [filterTipo, setFilterTipo] = useState<string>("all");
  const [viewMode, setViewMode] = useState<ViewMode>("grid");

  // Hook de streaming para IA
  const streamCallbacksRef = useRef<{
    onChunk?: (chunk: string) => void;
    onComplete?: () => void;
    onError?: (error: string) => void;
  }>({});

  const { streamChat } = useAIStreaming({
    onChunk: (chunk) => {
      streamCallbacksRef.current.onChunk?.(chunk);
    },
    onComplete: () => {
      streamCallbacksRef.current.onComplete?.();
    },
    onError: (err) => {
      console.error("[MinutasManager] Erro no streaming:", err);
      toast.error("Erro no streaming de IA");
      streamCallbacksRef.current.onError?.(err);
    },
  });

  const [formData, setFormData] = useState({
    titulo: "",
    processId: "_none",
    tipo: "peticao" as Minuta["tipo"],
    conteudo: "",
    status: "rascunho" as Minuta["status"],
  });

  const {
    continuar,
    expandir,
    revisar,
    formalizar,
    isLoading: isAICommandLoading,
    error: aiCommandError,
    canRequest: canAIRequest,
    waitTime: aiWaitTime,
    checkStatus: checkAIStatus,
  } = useAICommands();

  const [activeAICommand, setActiveAICommand] = useState<string | null>(null);

  useEffect(() => {
    checkAIStatus();
  }, [checkAIStatus]);

  useEffect(() => {
    if (aiCommandError) {
      toast.error(Erro no comando IA: ${aiCommandError});
    }
  }, [aiCommandError]);

  const handleAICommand = useCallback(
    async (
      command: "continuar" | "expandir" | "revisar" | "formalizar",
      mode: "append" | "replace"
    ) => {
      if (!formData.conteudo.trim()) {
        toast.error("Adicione algum conteÃºdo antes de usar os comandos de IA");
        return;
      }

      if (!canAIRequest) {
        const waitSeconds = Math.ceil(aiWaitTime / 1000);
        toast.warning(Aguarde ${waitSeconds}s antes do prÃ³ximo comando, {
          description: "Limite de requisiÃ§Ãµes atingido",
        });
        return;
      }

      setActiveAICommand(command);
      let streamedContent = "";

      const commandFn = { continuar, expandir, revisar, formalizar }[command];

      try {
        await commandFn(formData.conteudo, (chunk) => {
          streamedContent += chunk;
          if (mode === "append") {
            setFormData((prev) => ({
              ...prev,
              conteudo: prev.conteudo + chunk,
            }));
          } else {
            setFormData((prev) => ({
              ...prev,
              conteudo: streamedContent,
            }));
          }
        });

        toast.success(Comando "${command}" executado com sucesso!);
      } catch (err) {
        console.error([MinutasManager] Erro no comando ${command}:, err);
      } finally {
        setActiveAICommand(null);
      }
    },
    [formData.conteudo, canAIRequest, aiWaitTime, continuar, expandir, revisar, formalizar]
  );

  useEffect(() => {
    const initGoogleDocs = async () => {
      if (!isGoogleConfigured) {
        setIsAuthenticated(false);
        return;
      }
      try {
        await googleDocsService.initialize();
        const authenticated = googleDocsService.isAuthenticated();
        setIsAuthenticated(authenticated);
      } catch (err) {
        console.error("[MinutasManager] âŒ Google Docs init falhou:", err);
        setIsAuthenticated(false);
      }
    };
    initGoogleDocs();
  }, []);

  useEffect(() => {
    if (formData.processId && formData.processId !== "_none") {
      const processo = (processes || []).find((p) => p.id === formData.processId);
      if (processo) {
        setVariableValues((prev) => ({
          ...prev,
          "processo.numero": processo.numeroCNJ || "",
          "processo.titulo": processo.titulo || "",
          "autor.nome": processo.autor || "",
          "reu.nome": processo.reu || "",
          comarca: processo.comarca || "",
          vara: processo.vara || "",
        }));
      }
    }
  }, [formData.processId, processes]);

  const resetForm = () => {
    setFormData({
      titulo: "",
      processId: "_none",
      tipo: "peticao",
      conteudo: "",
      status: "rascunho",
    });
    setSelectedTemplate(null);
    setVariableValues({});
    setActiveTab("editor");
  };

  const handleAuthGoogle = async () => {
    try {
      if (!isGoogleConfigured) {
        toast.error("Google nÃ£o estÃ¡ configurado no ambiente (.env)");
        return;
      }

      // Mostrar loading toast
      const toastId = toast.loading("Inicializando Google Docs...");

      try {
        await googleDocsService.initialize();
        toast.success("Google Docs inicializado!", { id: toastId });
      } catch (initError) {
        const errorMsg =
          initError instanceof Error ? initError.message : "Erro ao inicializar Google Docs";

        // Mensagens mais especÃ­ficas baseadas no erro
        let userMessage = errorMsg;
        if (errorMsg.includes("Timeout")) {
          userMessage = "Timeout ao carregar Google Docs. Verifique sua conexÃ£o e tente novamente.";
        } else if (errorMsg.includes("Failed to load")) {
          userMessage =
            "NÃ£o foi possÃ­vel carregar scripts do Google. Verifique se vocÃª estÃ¡ conectado Ã  internet.";
        } else if (errorMsg.includes("API key")) {
          userMessage = "Credenciais do Google invÃ¡lidas. Contate o suporte.";
        }

        toast.error(Falha na inicializaÃ§Ã£o: ${userMessage}, { id: toastId });
        console.error("[MinutasManager] Google Docs init error:", initError);
        return;
      }

      const success = await googleDocsService.authenticate();

      if (success) {
        setIsAuthenticated(true);
        toast.success("Autenticado com Google Docs!");
      } else {
        const lastError = googleDocsService.getLastError();
        toast.error(lastError || "Falha na autenticaÃ§Ã£o - verifique se popups estÃ£o permitidos");
      }
    } catch (error) {
      const errorMsg = error instanceof Error ? error.message : "Erro desconhecido";
      toast.error(Erro ao autenticar: ${errorMsg});
      console.error("[MinutasManager] Auth error:", error);
    }
  };

  const handleCreateMinuta = async () => {
    if (!formData.titulo || !formData.conteudo) {
      toast.error("Preencha tÃ­tulo e conteÃºdo");
      return;
    }

    try {
      const minutaInput: MinutaInput = {
        titulo: formData.titulo,
        processId: formData.processId === "_none" ? undefined : formData.processId,
        tipo: formData.tipo,
        conteudo: formData.conteudo,
        status: formData.status,
        autor: "current-user",
        criadoPorAgente: false,
      };

      const novaMinuta = createMinuta(minutaInput);

      setMinutas((current = []) => [...current, novaMinuta]);

      resetForm();
      setIsDialogOpen(false);
      toast.success("Minuta criada com sucesso!");
    } catch (error) {
      const errorMsg = error instanceof Error ? error.message : "Erro ao criar minuta";
      toast.error(errorMsg);
    }
  };

  const handleUpdateMinuta = async () => {
    if (!editingMinuta || !formData.titulo || !formData.conteudo) {
      toast.error("Preencha tÃ­tulo e conteÃºdo");
      return;
    }

    try {
      if (formData.status === "finalizada") {
        const validation = validateMinutaForFinalization({
          ...editingMinuta,
          titulo: formData.titulo,
          conteudo: formData.conteudo,
        });

        if (!validation.valid) {
          toast.error("Minuta nÃ£o pode ser finalizada", {
            description: validation.errors.join(", "),
          });
          return;
        }
      }

      const minutaAtualizada = updateMinuta(editingMinuta, {
        titulo: formData.titulo,
        processId: formData.processId === "_none" ? undefined : formData.processId,
        tipo: formData.tipo,
        conteudo: formData.conteudo,
        status: formData.status,
      });

      setMinutas((current = []) =>
        current.map((m) => (m.id === editingMinuta.id ? minutaAtualizada : m))
      );

      if (minutaAtualizada.googleDocsId) {
        const syncSuccess = await googleDocsService.updateDocumentContent(
          minutaAtualizada.googleDocsId,
          minutaAtualizada.conteudo
        );
        if (syncSuccess) {
          toast.success("Minuta atualizada e sincronizada com Google Docs");
        } else {
          toast.warning("Minuta atualizada, mas falha ao sincronizar com Google Docs");
        }
      } else {
        toast.success("Minuta atualizada com sucesso!");
      }

      resetForm();
      setIsDialogOpen(false);
      setEditingMinuta(null);
    } catch (error) {
      const errorMsg = error instanceof Error ? error.message : "Erro ao atualizar minuta";
      toast.error(errorMsg);
    }
  };

  const handleEditMinuta = (minuta: Minuta) => {
    setEditingMinuta(minuta);
    setFormData({
      titulo: minuta.titulo,
      processId: minuta.processId || "_none",
      tipo: minuta.tipo,
      conteudo: minuta.conteudo,
      status: minuta.status,
    });
    setIsDialogOpen(true);
  };

  const handleDeleteMinuta = (id: string) => {
    setMinutas((current = []) => current.filter((m) => m.id !== id));
    toast.success("Minuta excluÃ­da com sucesso!");
  };

  const handleApproveMinuta = (id: string) => {
    setMinutas((current = []) =>
      current.map((m) =>
        m.id === id
          ? {
              ...m,
              status: "finalizada" as Minuta["status"],
              atualizadoEm: new Date().toISOString(),
            }
          : m
      )
    );
    toast.success("Minuta aprovada e finalizada!");
  };

  const handleDuplicateMinuta = (minuta: Minuta) => {
    const duplicada = createMinuta({
      titulo: ${minuta.titulo} (CÃ³pia),
      processId: minuta.processId,
      tipo: minuta.tipo,
      conteudo: minuta.conteudo,
      status: "rascunho",
      autor: "current-user",
      criadoPorAgente: false,
    });

    setMinutas((current = []) => [...current, duplicada]);
    toast.success("Minuta duplicada com sucesso!");
  };

  const handleExportPDF = (_minuta: Minuta) => {
    toast.info("ExportaÃ§Ã£o para PDF em desenvolvimento");
  };

  const handleExportDOCX = (_minuta: Minuta) => {
    toast.info("ExportaÃ§Ã£o para DOCX em desenvolvimento");
  };

  const handleOpenInGoogleDocs = async (minuta: Minuta) => {
    if (!isAuthenticated) {
      toast.error("Autentique com Google Docs primeiro");
      return;
    }

    try {
      if (minuta.googleDocsUrl) {
        openDocument(minuta.googleDocsUrl);
        toast.success("Abrindo documento no Google Docs...");
      } else {
        const result = await exportToGoogleDocs(minuta);
        if (result) {
          setMinutas((current = []) =>
            current.map((m) =>
              m.id === minuta.id
                ? {
                    ...m,
                    googleDocsId: result.docId,
                    googleDocsUrl: result.url,
                    ultimaSincronizacao: new Date().toISOString(),
                  }
                : m
            )
          );
          openDocument(result.url);
          toast.success("Documento criado e aberto no Google Docs!");
        }
      }
    } catch (_error) {
      toast.error("Erro ao abrir no Google Docs");
    }
  };

  const handleSyncFromGoogleDocs = async (minuta: Minuta) => {
    if (!minuta.googleDocsId) return;

    setIsSyncing(minuta.id);
    try {
      const success = await importFromGoogleDocs(minuta.id, minutas || [], setMinutas);
      if (success) {
        toast.success("AlteraÃ§Ãµes importadas do Google Docs!");
      }
    } catch (_error) {
      toast.error("Erro ao importar do Google Docs");
    } finally {
      setIsSyncing(null);
    }
  };

  const handleApplyTemplate = (template: DocumentTemplate) => {
    setSelectedTemplate(template);
    setFormData({
      ...formData,
      titulo: template.nome,
      tipo: template.categoria as Minuta["tipo"],
      conteudo: template.conteudo,
    });

    const initialValues: Record<string, string> = {};
    template.variaveis.forEach((v) => {
      initialValues[v] = variableValues[v] || "";
    });
    setVariableValues(initialValues);

    setActiveTab("editor");
    toast.success(Template "${template.nome}" aplicado!);
  };

  const handleFillVariables = () => {
    const filled = replaceTemplateVariables(formData.conteudo, variableValues);
    setFormData({ ...formData, conteudo: filled });
    toast.success("VariÃ¡veis preenchidas no documento!");
  };

  const handleAIGenerate = async (prompt: string): Promise<string> => {
    if (!isGeminiConfigured()) {
      throw new Error("Gemini nÃ£o estÃ¡ configurado");
    }

    const fullPrompt = VocÃª Ã© um assistente jurÃ­dico especializado em redaÃ§Ã£o de documentos legais brasileiros.
Sua funÃ§Ã£o Ã© ajudar na criaÃ§Ã£o, ediÃ§Ã£o e melhoria de petiÃ§Ãµes, contratos, pareceres e outros documentos jurÃ­dicos.
Sempre use linguagem formal e tÃ©cnica apropriada. Cite legislaÃ§Ã£o e jurisprudÃªncia quando relevante.
Mantenha formataÃ§Ã£o HTML adequada para o editor (use <p>, <strong>, <em>, <ul>, <li>, <blockquote>).

${prompt};

    const response = await callGemini(fullPrompt);

    return response.text;
  };

  const handleAIStream = useCallback(
    async (
      prompt: string,
      callbacks: {
        onChunk: (chunk: string) => void;
        onComplete: () => void;
        onError: (error: Error) => void;
      }
    ) => {
      streamCallbacksRef.current = {
        onChunk: callbacks.onChunk,
        onComplete: callbacks.onComplete,
        onError: (err) => callbacks.onError(new Error(err)),
      };

      try {
        await streamChat([
          {
            role: "system",
            content: VocÃª Ã© um assistente jurÃ­dico especializado em redaÃ§Ã£o de documentos legais brasileiros.
Sua funÃ§Ã£o Ã© ajudar na criaÃ§Ã£o, ediÃ§Ã£o e melhoria de petiÃ§Ãµes, contratos, pareceres e outros documentos jurÃ­dicos.
Sempre use linguagem formal e tÃ©cnica apropriada. Cite legislaÃ§Ã£o e jurisprudÃªncia quando relevante.
Mantenha formataÃ§Ã£o HTML adequada para o editor (use <p>, <strong>, <em>, <ul>, <li>, <blockquote>).,
          },
          { role: "user", content: prompt },
        ]);
      } catch (err) {
        callbacks.onError(err instanceof Error ? err : new Error("Erro no streaming"));
      }
    },
    [streamChat]
  );

  // Alinhado ao design system semÃ¢ntico em src/lib/themes.ts
  const getStatusStyle = (status: Minuta["status"]): React.CSSProperties => {
    const map: Record<Minuta["status"], string> = {
      rascunho: themeConfig.colors.alerta, // amarelo
      "em-revisao": themeConfig.colors.info, // azul
      "pendente-revisao": themeConfig.colors.alerta, // laranja
      finalizada: themeConfig.colors.sucesso, // verde
      arquivada: "hsl(0, 0%, 45%)", // cinza neutro
    } as const;

    const base = map[status] || themeConfig.colors.info;
    return {
      color: base,
      backgroundColor: ${base.replace("hsl", "hsla").replace(")", ", 0.10)")},
      borderColor: ${base.replace("hsl", "hsla").replace(")", ", 0.20)")},
    };
  };

  const getStatusLabel = (status: Minuta["status"]) => {
    const labels = {
      rascunho: "Rascunho",
      "em-revisao": "Em RevisÃ£o",
      "pendente-revisao": "Pendente RevisÃ£o",
      finalizada: "Finalizada",
      arquivada: "Arquivada",
    };
    return labels[status] || status;
  };

  const getTipoLabel = (tipo: Minuta["tipo"]) => {
    const labels = {
      peticao: "PetiÃ§Ã£o",
      contrato: "Contrato",
      parecer: "Parecer",
      recurso: "Recurso",
      procuracao: "ProcuraÃ§Ã£o",
      outro: "Outro",
    };
    return labels[tipo] || tipo;
  };

  const getAlertStyle = (): React.CSSProperties => {
    const base = themeConfig.colors.alerta;
    return {
      color: base,
      backgroundColor: ${base.replace("hsl", "hsla").replace(")", ", 0.10)")},
      borderColor: ${base.replace("hsl", "hsla").replace(")", ", 0.20)")},
    };
  };

  const getSuccessStyle = (): React.CSSProperties => {
    const base = themeConfig.colors.sucesso;
    return {
      color: base,
      backgroundColor: ${base.replace("hsl", "hsla").replace(")", ", 0.10)")},
      borderColor: ${base.replace("hsl", "hsla").replace(")", ", 0.20)")},
    };
  };

  const getInfoStyle = (): React.CSSProperties => {
    const base = themeConfig.colors.info;
    return {
      color: base,
      backgroundColor: ${base.replace("hsl", "hsla").replace(")", ", 0.10)")},
      borderColor: ${base.replace("hsl", "hsla").replace(")", ", 0.20)")},
    };
  };

  // Filtrar minutas
  const filteredMinutas = (minutas || []).filter((m) => {
    const matchesSearch =
      searchQuery === "" || m.titulo.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = filterStatus === "all" || m.status === filterStatus;
    const matchesTipo = filterTipo === "all" || m.tipo === filterTipo;
    return matchesSearch && matchesStatus && matchesTipo;
  });

  // Minutas pendentes de revisÃ£o
  const minutasPendentes = (minutas || []).filter(
    (m) => m.status === "pendente-revisao" || m.criadoPorAgente
  );

  // VariÃ¡veis nÃ£o preenchidas
  const unfilledVariables = extractUnfilledVariables(formData.conteudo);

  return (
    <div className="p-6 space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between flex-wrap gap-4">
        <div>
          <h1 className="text-3xl font-bold text-foreground flex items-center gap-3">
            <FileText className="text-primary" />
            Editor de Minutas
          </h1>
          <p className="text-muted-foreground mt-1">
            Editor rico com IA (Gemini 2.5 Pro) e sincronizaÃ§Ã£o com Google Docs
          </p>
        </div>

        <div className="flex gap-3 flex-wrap">
          {(() => {
            if (!isGoogleConfigured) {
              return (
                <Badge variant="outline" style={getAlertStyle()} className="px-4 py-2">
                  <AlertTriangle className="mr-2 h-4 w-4" />
                  Google nÃ£o configurado
                </Badge>
              );
            }
            if (!isAuthenticated) {
              return (
                <Button onClick={handleAuthGoogle} variant="outline">
                  <FileText className="mr-2" />
                  Conectar Google Docs
                </Button>
              );
            }
            return (
              <Badge style={getSuccessStyle()} className="px-4 py-2">
                <FileText className="mr-2" />
                Google Conectado
              </Badge>
            );
          })()}

          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
            <DialogTrigger asChild>
              <Button
                onClick={() => {
                  setEditingMinuta(null);
                  resetForm();
                }}
              >
                <Plus className="mr-2" />
                Nova Minuta
              </Button>
            </DialogTrigger>

            <DialogContent className="max-w-6xl max-h-[95vh] overflow-y-auto flex flex-col bg-card">
              <DialogHeader>
                <DialogTitle className="flex items-center gap-2">
                  {editingMinuta ? (
                    <>
                      <Pencil />
                      Editar Minuta
                    </>
                  ) : (
                    <>
                      <Plus />
                      Nova Minuta
                    </>
                  )}
                </DialogTitle>
                <DialogDescription>
                  Use o editor rico para criar sua minuta. Use o botÃ£o de IA para gerar conteÃºdo
                  automaticamente com Gemini 2.5 Pro.
                </DialogDescription>
              </DialogHeader>

              <Tabs
                value={activeTab}
                onValueChange={setActiveTab}
                className="flex-1 flex flex-col overflow-hidden"
              >
                <TabsList className="grid w-full grid-cols-3">
                  <TabsTrigger value="editor">Editor</TabsTrigger>
                  <TabsTrigger value="templates">Templates</TabsTrigger>
                  <TabsTrigger value="variaveis">VariÃ¡veis</TabsTrigger>
                </TabsList>

                <TabsContent
                  value="editor"
                  className="flex-1 flex flex-col overflow-hidden mt-4 space-y-4"
                >
                  {/* Metadados */}
                  <div className="grid grid-cols-4 gap-4">
                    <div className="col-span-2">
                      <Label htmlFor="titulo">TÃ­tulo</Label>
                      <Input
                        id="titulo"
                        value={formData.titulo}
                        onChange={(e) => setFormData({ ...formData, titulo: e.target.value })}
                        placeholder="Ex: PetiÃ§Ã£o Inicial - AÃ§Ã£o de CobranÃ§a"
                      />
                    </div>

                    <div>
                      <Label htmlFor="tipo">Tipo</Label>
                      <Select
                        value={formData.tipo}
                        onValueChange={(value) =>
                          setFormData({
                            ...formData,
                            tipo: value as Minuta["tipo"],
                          })
                        }
                      >
                        <SelectTrigger id="tipo">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="peticao">PetiÃ§Ã£o</SelectItem>
                          <SelectItem value="contrato">Contrato</SelectItem>
                          <SelectItem value="parecer">Parecer</SelectItem>
                          <SelectItem value="recurso">Recurso</SelectItem>
                          <SelectItem value="procuracao">ProcuraÃ§Ã£o</SelectItem>
                          <SelectItem value="outro">Outro</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div>
                      <Label htmlFor="status">Status</Label>
                      <Select
                        value={formData.status}
                        onValueChange={(value) =>
                          setFormData({
                            ...formData,
                            status: value as Minuta["status"],
                          })
                        }
                      >
                        <SelectTrigger id="status">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="rascunho">Rascunho</SelectItem>
                          <SelectItem value="em-revisao">Em RevisÃ£o</SelectItem>
                          <SelectItem value="finalizada">Finalizada</SelectItem>
                          <SelectItem value="arquivada">Arquivada</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  <div>
                    <Label htmlFor="processo">Vincular a Processo (opcional)</Label>
                    <Select
                      value={formData.processId}
                      onValueChange={(value) => setFormData({ ...formData, processId: value })}
                    >
                      <SelectTrigger id="processo">
                        <SelectValue placeholder="Selecione um processo" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="_none">Nenhum</SelectItem>
                        {(processes || []).map((p) => (
                          <SelectItem key={p.id} value={p.id}>
                            {p.numeroCNJ} - {p.titulo}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  {/* Editor - CKEditor 5 */}
                  <div className="flex-1 overflow-hidden flex flex-col min-h-[400px]">
                    <ProfessionalEditor
                      key={editingMinuta?.id || "new-minuta"}
                      content={formData.conteudo}
                      onChange={(content) => setFormData({ ...formData, conteudo: content })}
                      onAIGenerate={handleAIGenerate}
                      onAIStream={handleAIStream}
                      variables={variableValues}
                      placeholder="Digite o conteÃºdo da minuta ou use o botÃ£o de IA para gerar com Gemini..."
                      className="h-full min-h-[400px]"
                      showCollaboration={false}
                    />
                  </div>

                  {/* Comandos IA */}
                  <Card className="border-purple-500/30 bg-purple-50/50 dark:bg-purple-950/20">
                    <CardHeader className="py-3 px-4">
                      <CardTitle className="text-sm flex items-center gap-2">
                        <Bot className="h-4 w-4 text-purple-600" />
                        Comandos IA
                        {isAICommandLoading && (
                          <Badge variant="secondary" className="ml-2">
                            <Loader2 className="h-3 w-3 mr-1 animate-spin" />
                            Processando...
                          </Badge>
                        )}
                        {!canAIRequest && aiWaitTime > 0 && (
                          <Badge
                            variant="outline"
                            className="ml-2 text-orange-600 border-orange-500"
                          >
                            <Clock className="h-3 w-3 mr-1" />
                            Aguarde {Math.ceil(aiWaitTime / 1000)}s
                          </Badge>
                        )}
                      </CardTitle>
                      <CardDescription className="text-xs">
                        Use os comandos abaixo para processar o texto com IA
                      </CardDescription>
                    </CardHeader>
                    <CardContent className="py-2 px-4">
                      <div className="grid grid-cols-4 gap-2">
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => handleAICommand("continuar", "append")}
                          disabled={isAICommandLoading || !formData.conteudo.trim()}
                          className="flex flex-col items-center gap-1 h-auto py-3 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-950/30"
                        >
                          {activeAICommand === "continuar" ? (
                            <Loader2 className="h-4 w-4 animate-spin text-purple-600" />
                          ) : (
                            <Zap className="h-4 w-4 text-purple-600" />
                          )}
                          <span className="font-medium">Continuar</span>
                          <span className="text-[10px] text-muted-foreground text-center">
                            Continua a escrita
                          </span>
                        </Button>

                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => handleAICommand("expandir", "replace")}
                          disabled={isAICommandLoading || !formData.conteudo.trim()}
                          className="flex flex-col items-center gap-1 h-auto py-3 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-950/30"
                        >
                          {activeAICommand === "expandir" ? (
                            <Loader2 className="h-4 w-4 animate-spin text-purple-600" />
                          ) : (
                            <Expand className="h-4 w-4 text-purple-600" />
                          )}
                          <span className="font-medium">Expandir</span>
                          <span className="text-[10px] text-muted-foreground text-center">
                            Desenvolve o texto
                          </span>
                        </Button>

                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => handleAICommand("revisar", "replace")}
                          disabled={isAICommandLoading || !formData.conteudo.trim()}
                          className="flex flex-col items-center gap-1 h-auto py-3 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-950/30"
                        >
                          {activeAICommand === "revisar" ? (
                            <Loader2 className="h-4 w-4 animate-spin text-purple-600" />
                          ) : (
                            <Sparkles className="h-4 w-4 text-purple-600" />
                          )}
                          <span className="font-medium">Revisar</span>
                          <span className="text-[10px] text-muted-foreground text-center">
                            Melhora gramÃ¡tica
                          </span>
                        </Button>

                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => handleAICommand("formalizar", "replace")}
                          disabled={isAICommandLoading || !formData.conteudo.trim()}
                          className="flex flex-col items-center gap-1 h-auto py-3 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-950/30"
                        >
                          {activeAICommand === "formalizar" ? (
                            <Loader2 className="h-4 w-4 animate-spin text-purple-600" />
                          ) : (
                            <Wand2 className="h-4 w-4 text-purple-600" />
                          )}
                          <span className="font-medium">Formalizar</span>
                          <span className="text-[10px] text-muted-foreground text-center">
                            Linguagem jurÃ­dica
                          </span>
                        </Button>
                      </div>
                    </CardContent>
                  </Card>

                  {/* VariÃ¡veis nÃ£o preenchidas */}
                  {unfilledVariables.length > 0 && (
                    <Alert
                      style={{
                        borderColor: ${themeConfig.colors.alerta.replace("hsl", "hsla").replace(")", ", 0.50)")},
                        backgroundColor: ${themeConfig.colors.alerta.replace("hsl", "hsla").replace(")", ", 0.10)")},
                      }}
                    >
                      <AlertTriangle
                        className="h-4 w-4"
                        style={{ color: themeConfig.colors.alerta }}
                      />
                      <AlertDescription style={{ color: themeConfig.colors.alerta }}>
                        <strong>{unfilledVariables.length} variÃ¡veis nÃ£o preenchidas:</strong>{" "}
                        {unfilledVariables.slice(0, 5).join(", ")}
                        {unfilledVariables.length > 5 &&  e mais ${unfilledVariables.length - 5}}
                        <Button
                          variant="link"
                          size="sm"
                          className="ml-2"
                          style={{ color: themeConfig.colors.alerta }}
                          onClick={() => setActiveTab("variaveis")}
                        >
                          Preencher variÃ¡veis â†’
                        </Button>
                      </AlertDescription>
                    </Alert>
                  )}
                </TabsContent>

                <TabsContent value="templates" className="flex-1 overflow-hidden mt-4">
                  <div className="space-y-4 h-full flex flex-col">
                    <div className="flex gap-2">
                      <div className="relative flex-1">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                        <Input
                          placeholder="Buscar templates..."
                          className="pl-9"
                          value={searchQuery}
                          onChange={(e) => setSearchQuery(e.target.value)}
                        />
                      </div>
                    </div>

                    <ScrollArea className="flex-1">
                      <div className="grid grid-cols-2 gap-3">
                        {documentTemplates
                          .filter(
                            (t) =>
                              searchQuery === "" ||
                              t.nome.toLowerCase().includes(searchQuery.toLowerCase()) ||
                              t.categoria.toLowerCase().includes(searchQuery.toLowerCase())
                          )
                          .map((template) => (
                            <Card
                              key={template.id}
                              className={cursor-pointer transition-all hover:border-primary/50 ${
                                selectedTemplate?.id === template.id
                                  ? "border-primary bg-primary/5"
                                  : ""
                              }}
                              onClick={() => handleApplyTemplate(template)}
                            >
                              <CardHeader className="p-4">
                                <CardTitle className="text-sm flex items-center gap-2">
                                  <FolderOpen className="h-4 w-4" />
                                  {template.nome}
                                </CardTitle>
                                <CardDescription className="text-xs">
                                  {template.descricao}
                                </CardDescription>
                              </CardHeader>
                              <CardContent className="p-4 pt-0">
                                <div className="flex gap-2 flex-wrap">
                                  <Badge variant="outline" className="text-xs">
                                    {template.categoria}
                                  </Badge>
                                  <Badge variant="secondary" className="text-xs">
                                    {template.variaveis.length} variÃ¡veis
                                  </Badge>
                                </div>
                              </CardContent>
                            </Card>
                          ))}
                      </div>
                    </ScrollArea>
                  </div>
                </TabsContent>

                <TabsContent value="variaveis" className="flex-1 overflow-hidden mt-4">
                  <div className="space-y-4 h-full flex flex-col">
                    <p className="text-sm text-muted-foreground">
                      Preencha as variÃ¡veis para substituir automaticamente no documento. Use o
                      formato <code className="bg-muted px-1 rounded">{"{{variavel}}"}</code>.
                    </p>

                    <ScrollArea className="flex-1">
                      <div className="grid grid-cols-2 gap-4">
                        {(selectedTemplate?.variaveis || unfilledVariables).map((variable) => (
                          <div key={variable}>
                            <Label className="text-xs">{variable}</Label>
                            <Input
                              value={variableValues[variable] || ""}
                              onChange={(e) =>
                                setVariableValues((prev) => ({
                                  ...prev,
                                  [variable]: e.target.value,
                                }))
                              }
                              placeholder={Valor para ${variable}}
                            />
                          </div>
                        ))}
                      </div>
                    </ScrollArea>

                    <Button onClick={handleFillVariables} className="w-full">
                      <Sparkles className="mr-2" />
                      Aplicar VariÃ¡veis no Documento
                    </Button>
                  </div>
                </TabsContent>
              </Tabs>

              {/* Footer */}
              <div className="flex justify-end gap-2 mt-4 pt-4 border-t">
                <Button
                  variant="outline"
                  onClick={() => {
                    setIsDialogOpen(false);
                    setEditingMinuta(null);
                  }}
                >
                  Cancelar
                </Button>
                <Button onClick={editingMinuta ? handleUpdateMinuta : handleCreateMinuta}>
                  {editingMinuta ? "Atualizar" : "Criar"} Minuta
                </Button>
              </div>
            </DialogContent>
          </Dialog>
        </div>
      </div>

      {/* Alertas de minutas pendentes */}
      {minutasPendentes.length > 0 && (
        <Alert className="border-orange-500/50 bg-orange-50 dark:bg-orange-950/20">
          <Bot className="h-4 w-4 text-orange-600" />
          <AlertDescription className="text-orange-800 dark:text-orange-200">
            <strong>{minutasPendentes.length} minuta(s) pendente(s) de revisÃ£o</strong> criada(s)
            pelos agentes IA.
            <div className="flex gap-2 mt-2">
              {minutasPendentes.slice(0, 3).map((m) => (
                <Button
                  key={m.id}
                  variant="outline"
                  size="sm"
                  onClick={() => handleEditMinuta(m)}
                  className="text-orange-600 border-orange-500/50"
                >
                  <Eye className="mr-1 h-3 w-3" />
                  {m.titulo.substring(0, 20)}...
                </Button>
              ))}
            </div>
          </AlertDescription>
        </Alert>
      )}

      {/* Filtros e View Toggle */}
      <div className="flex gap-4 flex-wrap items-center">
        <div className="relative flex-1 max-w-sm">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
          <Input
            placeholder="Buscar minutas..."
            className="pl-9"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
          />
        </div>

        <Select value={filterStatus} onValueChange={setFilterStatus}>
          <SelectTrigger className="w-[150px]">
            <SelectValue placeholder="Status" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">Todos Status</SelectItem>
            <SelectItem value="rascunho">Rascunho</SelectItem>
            <SelectItem value="em-revisao">Em RevisÃ£o</SelectItem>
            <SelectItem value="pendente-revisao">Pendente RevisÃ£o</SelectItem>
            <SelectItem value="finalizada">Finalizada</SelectItem>
            <SelectItem value="arquivada">Arquivada</SelectItem>
          </SelectContent>
        </Select>

        <Select value={filterTipo} onValueChange={setFilterTipo}>
          <SelectTrigger className="w-[150px]">
            <SelectValue placeholder="Tipo" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">Todos Tipos</SelectItem>
            <SelectItem value="peticao">PetiÃ§Ã£o</SelectItem>
            <SelectItem value="contrato">Contrato</SelectItem>
            <SelectItem value="parecer">Parecer</SelectItem>
            <SelectItem value="recurso">Recurso</SelectItem>
            <SelectItem value="procuracao">ProcuraÃ§Ã£o</SelectItem>
            <SelectItem value="outro">Outro</SelectItem>
          </SelectContent>
        </Select>

        <Badge variant="secondary">{filteredMinutas.length} minuta(s)</Badge>

        {/* View Mode Toggle */}
        <div className="flex gap-1 border rounded-lg p-1">
          <Button
            size="sm"
            variant={viewMode === "grid" ? "secondary" : "ghost"}
            onClick={() => setViewMode("grid")}
            className="px-3"
            aria-label="VisualizaÃ§Ã£o em grade"
            title="VisualizaÃ§Ã£o em grade"
          >
            <Grid3x3 className="h-4 w-4" />
          </Button>
          <Button
            size="sm"
            variant={viewMode === "list" ? "secondary" : "ghost"}
            onClick={() => setViewMode("list")}
            className="px-3"
            aria-label="VisualizaÃ§Ã£o em lista"
            title="VisualizaÃ§Ã£o em lista"
          >
            <List className="h-4 w-4" />
          </Button>
        </div>
      </div>

      {/* Lista de Minutas */}
      {filteredMinutas.length === 0 ? (
        <Card>
          <CardContent className="flex flex-col items-center justify-center py-12">
            <FileText size={64} className="text-muted-foreground mb-4" />
            <p className="text-muted-foreground text-center">
              {searchQuery || filterStatus !== "all" || filterTipo !== "all"
                ? "Nenhuma minuta encontrada com os filtros aplicados."
                : "Nenhuma minuta criada ainda."}
              <br />
              Clique em &quot;Nova Minuta&quot; para comeÃ§ar.
            </p>
          </CardContent>
        </Card>
      ) : (
        <div
          className={
            viewMode === "grid"
              ? "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
              : "grid gap-4"
          }
          data-testid="minutas-container"
        >
          {filteredMinutas.map((minuta) => {
            const processo = (processes || []).find((p) => p.id === minuta.processId);

            return (
              <Card
                key={minuta.id}
                className={transition-all hover:shadow-md ${minuta.criadoPorAgente ? "border-orange-500/30" : ""}}
              >
                <CardHeader>
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <CardTitle className="flex items-center gap-2 text-base">
                        <FileText className="text-primary h-4 w-4" />
                        {minuta.titulo}
                        {minuta.criadoPorAgente && (
                          <Badge style={getInfoStyle()}>
                            <Bot className="mr-1 h-3 w-3" />
                            IA
                          </Badge>
                        )}
                      </CardTitle>
                      <CardDescription className="mt-2 flex items-center gap-2 flex-wrap">
                        <Badge style={getStatusStyle(minuta.status)}>
                          {getStatusLabel(minuta.status)}
                        </Badge>
                        <Badge variant="outline">{getTipoLabel(minuta.tipo)}</Badge>
                        {processo && (
                          <Badge variant="secondary" className="text-xs">
                            {processo.numeroCNJ}
                          </Badge>
                        )}
                        {minuta.googleDocsId && (
                          <Badge style={getInfoStyle()}>
                            <FileText className="mr-1 h-3 w-3" />
                            Google Docs
                          </Badge>
                        )}
                      </CardDescription>
                    </div>
                  </div>
                </CardHeader>

                <CardContent>
                  <div className="space-y-4">
                    {/* Preview do conteÃºdo */}
                    {viewMode === "grid" && (
                      <div
                        className="text-sm text-muted-foreground bg-muted/50 p-4 rounded-lg max-h-24 overflow-hidden prose prose-sm dark:prose-invert line-clamp-3"
                        dangerouslySetInnerHTML={{
                          __html:
                            minuta.conteudo.substring(0, 200) +
                            (minuta.conteudo.length > 200 ? "..." : ""),
                        }}
                      />
                    )}

                    {/* Timestamps */}
                    <div className="flex items-center gap-4 text-xs text-muted-foreground">
                      <span className="flex items-center gap-1">
                        <Clock className="h-3 w-3" />
                        {new Date(minuta.atualizadoEm).toLocaleDateString("pt-BR")}
                      </span>
                      {minuta.ultimaSincronizacao && (
                        <span className="flex items-center gap-1">
                          <RefreshCw className="h-3 w-3" />
                          Sync
                        </span>
                      )}
                    </div>

                    {/* AÃ§Ãµes */}
                    <div className="flex gap-2 flex-wrap">
                      <Button size="sm" variant="outline" onClick={() => handleEditMinuta(minuta)}>
                        <Pencil className="mr-2 h-4 w-4" />
                        Editar
                      </Button>

                      {minuta.status !== "finalizada" && (
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => handleApproveMinuta(minuta.id)}
                          style={{
                            color: themeConfig.colors.sucesso,
                            borderColor: ${themeConfig.colors.sucesso.replace("hsl", "hsla").replace(")", ", 0.50)")},
                          }}
                          className="hover:opacity-80"
                        >
                          <CheckCircle className="mr-2 h-4 w-4" />
                          Aprovar
                        </Button>
                      )}

                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => handleDuplicateMinuta(minuta)}
                      >
                        <Copy className="mr-2 h-4 w-4" />
                        Duplicar
                      </Button>

                      <Popover>
                        <PopoverTrigger asChild>
                          <Button size="sm" variant="outline">
                            <Download className="mr-2 h-4 w-4" />
                            Exportar
                            <ChevronDown className="ml-1 h-3 w-3" />
                          </Button>
                        </PopoverTrigger>
                        <PopoverContent className="w-auto p-2">
                          <div className="flex flex-col gap-1">
                            <Button
                              variant="ghost"
                              size="sm"
                              onClick={() => handleExportPDF(minuta)}
                              className="justify-start"
                            >
                              <FileText className="mr-2 h-4 w-4" /> Exportar PDF
                            </Button>
                            <Button
                              variant="ghost"
                              size="sm"
                              onClick={() => handleExportDOCX(minuta)}
                              className="justify-start"
                            >
                              <FileText className="mr-2 h-4 w-4" /> Exportar DOC
                            </Button>
                            <Button
                              variant="ghost"
                              size="sm"
                              onClick={() => handleOpenInGoogleDocs(minuta)}
                              disabled={!isAuthenticated}
                              className="justify-start"
                            >
                              <FileText className="mr-2 h-4 w-4" />
                              {minuta.googleDocsUrl ? "Abrir no" : "Criar no"} Google Docs
                            </Button>
                          </div>
                        </PopoverContent>
                      </Popover>

                      {minuta.googleDocsId && (
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => handleSyncFromGoogleDocs(minuta)}
                          disabled={isSyncing === minuta.id}
                          title="Importar alteraÃ§Ãµes do Google Docs"
                        >
                          <RefreshCw
                            className={mr-2 h-4 w-4 ${
                              isSyncing === minuta.id ? "animate-spin" : ""
                            }}
                          />
                          {isSyncing === minuta.id ? "Importando..." : "Importar"}
                        </Button>
                      )}

                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => handleDeleteMinuta(minuta.id)}
                        className="text-destructive hover:text-destructive ml-auto"
                      >
                        <Trash className="mr-2 h-4 w-4" />
                        Excluir
                      </Button>
                    </div>
                  </div>
                </CardContent>
              </Card>
            );
          })}
        </div>
      )}
    </div>
  );
}
O ChatGPT disse:

Pensou por 21s
Boa â€” agora sim dÃ¡ pra â€œpegar no ossoâ€. âœ…
E um detalhe importante antes: alguns arquivos antigos que vocÃª tinha mandado em outras conversas expiraram aqui, entÃ£o eu vou trabalhar 100% em cima do que vocÃª colou agora.

Abaixo vai:

DiagnÃ³stico dos bugs/armadilhas que estÃ£o causando o comportamento estranho dos prints

Um arquivo MinutasManager.tsx completo corrigido, pronto pra vocÃª colar (mantive sua lÃ³gica, sÃ³ corrigi e melhorei UX/robustez).

1) Problemas reais que eu identifiquei (e que batem com os prints)
âœ… (A) Bug silencioso: vocÃª usa React.CSSProperties sem importar React
No Vite/TSX moderno, vocÃª costuma usar o runtime automÃ¡tico e nÃ£o existe React no escopo.
Resultado: pode dar erro de build/TS dependendo da config.

CorreÃ§Ã£o: usar type CSSProperties do react e trocar React.CSSProperties por CSSProperties.

âœ… (B) Seu searchQuery estÃ¡ sendo usado pra DUAS coisas
VocÃª usa searchQuery para:

buscar minutas (filtros)

buscar templates (aba templates)

Isso dÃ¡ um efeito colateral bem chato:

vocÃª pesquisa templates e â€œsomeâ€ com suas minutas na lista (e vice-versa)

CorreÃ§Ã£o: separar em minutaSearch e templateSearch.

âœ… (C) Scroll/overflow do modal estÃ¡ brigando com o editor (causa toolbar â€œsoltaâ€)
VocÃª estÃ¡ com:

DialogContent ... overflow-y-auto

Tabs ... overflow-hidden

TabsContent ... overflow-hidden

Isso gera scroll confuso e o editor parece â€œflutuandoâ€.

CorreÃ§Ã£o: tirar o scroll do DialogContent e colocar um ScrollArea sÃ³ no corpo.

âœ… (D) processId: "_none" polui estado e sincronizaÃ§Ã£o
VocÃª trata _none como â€œnenhumâ€ em vÃ¡rios lugares, mas isso vira lixo semÃ¢ntico no estado.

CorreÃ§Ã£o: guardar processId: "" (string vazia) e sÃ³ mapear para undefined quando salvar.

âœ… (E) Select sem placeholder
VocÃª usa <SelectValue /> sem placeholder em Tipo/Status â€” isso deixa UI estranha quando vazio.

CorreÃ§Ã£o: <SelectValue placeholder="Selecione..." />

âœ… (F) â€œGOOGLE_API_KEYâ€ estÃ¡ pegando VITE_GEMINI_API_KEY
Isso Ã© um naming bug. Google Docs API key e Gemini API key podem ser diferentes.
No mÃ­nimo, confunde manutenÃ§Ã£o.

CorreÃ§Ã£o segura: aceitar VITE_GOOGLE_API_KEY e cair pra VITE_GEMINI_API_KEY se nÃ£o existir (pra nÃ£o quebrar seu .env atual).

2) Arquivo completo corrigido (pronto pra colar)
âœ… Cole como src/.../MinutasManager.tsx substituindo o atual.
Mantive sua estrutura e lÃ³gica â€” sÃ³ corrigi bugs e apliquei hardening/UX.

import { Alert, AlertDescription } from "@/components/ui/alert";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import {
  Dialog,
  DialogContent,
  DialogDescription as DialogDescriptionUI,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";

import { useAICommands } from "@/hooks/use-ai-commands";
import { useAIStreaming } from "@/hooks/use-ai-streaming";
import { useGoogleDocs } from "@/hooks/use-google-docs";
import { useKV } from "@/hooks/use-kv";

import {
  documentTemplates,
  extractUnfilledVariables,
  replaceTemplateVariables,
  type DocumentTemplate,
} from "@/lib/document-templates";

import { callGemini, isGeminiConfigured } from "@/lib/gemini-service";
import { googleDocsService } from "@/lib/google-docs-service";
import { themeConfig } from "@/lib/themes";

import {
  createMinuta,
  updateMinuta,
  validateMinutaForFinalization,
  type MinutaInput,
} from "@/services/minuta-service";

import type { Minuta, Process } from "@/types";

import {
  AlertTriangle,
  Bot,
  CheckCircle,
  ChevronDown,
  Clock,
  Copy,
  Download,
  Expand,
  Eye,
  FileText,
  FolderOpen,
  Grid3x3,
  List,
  Loader2,
  Pencil,
  Plus,
  RefreshCw,
  Search,
  Sparkles,
  Trash,
  Wand2,
  Zap,
} from "lucide-react";

import { useCallback, useEffect, useMemo, useRef, useState, type CSSProperties } from "react";
import { toast } from "sonner";

import { ProfessionalEditor } from "@/components/editor/ProfessionalEditor";

type ViewMode = "grid" | "list";

/**
 * âœ… Google Docs config (corrigido):
 * - Usa VITE_GOOGLE_API_KEY se existir
 * - Fallback para VITE_GEMINI_API_KEY pra nÃ£o quebrar seu env atual
 */
const GOOGLE_CLIENT_ID = import.meta.env.VITE_GOOGLE_CLIENT_ID || "";
const GOOGLE_API_KEY = import.meta.env.VITE_GOOGLE_API_KEY || import.meta.env.VITE_GEMINI_API_KEY || "";
const isGoogleConfigured = !!GOOGLE_CLIENT_ID && !!GOOGLE_API_KEY;

export default function MinutasManager() {
  const [minutas, setMinutas] = useKV<Minuta[]>("minutas", []);
  const [processes] = useKV<Process[]>("processes", []);
  const { exportToGoogleDocs, importFromGoogleDocs, openDocument } = useGoogleDocs();

  const [isDialogOpen, setIsDialogOpen] = useState(false);
  const [editingMinuta, setEditingMinuta] = useState<Minuta | null>(null);
  const [isSyncing, setIsSyncing] = useState<string | null>(null);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [activeTab, setActiveTab] = useState<"editor" | "templates" | "variaveis">("editor");

  // âœ… SEPARAR buscas (bug de UX importante)
  const [minutaSearch, setMinutaSearch] = useState("");
  const [templateSearch, setTemplateSearch] = useState("");

  const [selectedTemplate, setSelectedTemplate] = useState<DocumentTemplate | null>(null);
  const [variableValues, setVariableValues] = useState<Record<string, string>>({});
  const [filterStatus, setFilterStatus] = useState<string>("all");
  const [filterTipo, setFilterTipo] = useState<string>("all");
  const [viewMode, setViewMode] = useState<ViewMode>("grid");

  // Hook de streaming para IA
  const streamCallbacksRef = useRef<{
    onChunk?: (chunk: string) => void;
    onComplete?: () => void;
    onError?: (error: string) => void;
  }>({});

  const { streamChat } = useAIStreaming({
    onChunk: (chunk) => streamCallbacksRef.current.onChunk?.(chunk),
    onComplete: () => streamCallbacksRef.current.onComplete?.(),
    onError: (err) => {
      console.error("[MinutasManager] Erro no streaming:", err);
      toast.error("Erro no streaming de IA");
      streamCallbacksRef.current.onError?.(err);
    },
  });

  // âœ… processId = "" (sem lixo "_none")
  const [formData, setFormData] = useState({
    titulo: "",
    processId: "",
    tipo: "peticao" as Minuta["tipo"],
    conteudo: "",
    status: "rascunho" as Minuta["status"],
  });

  const {
    continuar,
    expandir,
    revisar,
    formalizar,
    isLoading: isAICommandLoading,
    error: aiCommandError,
    canRequest: canAIRequest,
    waitTime: aiWaitTime,
    checkStatus: checkAIStatus,
  } = useAICommands();

  const [activeAICommand, setActiveAICommand] = useState<string | null>(null);

  useEffect(() => {
    checkAIStatus();
  }, [checkAIStatus]);

  useEffect(() => {
    if (aiCommandError) toast.error(`Erro no comando IA: ${aiCommandError}`);
  }, [aiCommandError]);

  const handleAICommand = useCallback(
    async (command: "continuar" | "expandir" | "revisar" | "formalizar", mode: "append" | "replace") => {
      if (!formData.conteudo.trim()) {
        toast.error("Adicione algum conteÃºdo antes de usar os comandos de IA");
        return;
      }

      if (!canAIRequest) {
        const waitSeconds = Math.ceil(aiWaitTime / 1000);
        toast.warning(`Aguarde ${waitSeconds}s antes do prÃ³ximo comando`, {
          description: "Limite de requisiÃ§Ãµes atingido",
        });
        return;
      }

      setActiveAICommand(command);
      let streamedContent = "";

      const commandFn = { continuar, expandir, revisar, formalizar }[command];

      try {
        await commandFn(formData.conteudo, (chunk) => {
          streamedContent += chunk;

          if (mode === "append") {
            setFormData((prev) => ({ ...prev, conteudo: prev.conteudo + chunk }));
          } else {
            setFormData((prev) => ({ ...prev, conteudo: streamedContent }));
          }
        });

        toast.success(`Comando "${command}" executado com sucesso!`);
      } catch (err) {
        console.error(`[MinutasManager] Erro no comando ${command}:`, err);
      } finally {
        setActiveAICommand(null);
      }
    },
    [formData.conteudo, canAIRequest, aiWaitTime, continuar, expandir, revisar, formalizar]
  );

  useEffect(() => {
    const initGoogleDocs = async () => {
      if (!isGoogleConfigured) {
        setIsAuthenticated(false);
        return;
      }
      try {
        await googleDocsService.initialize();
        setIsAuthenticated(googleDocsService.isAuthenticated());
      } catch (err) {
        console.error("[MinutasManager] âŒ Google Docs init falhou:", err);
        setIsAuthenticated(false);
      }
    };
    initGoogleDocs();
  }, []);

  useEffect(() => {
    if (formData.processId) {
      const processo = (processes || []).find((p) => p.id === formData.processId);
      if (processo) {
        setVariableValues((prev) => ({
          ...prev,
          "processo.numero": processo.numeroCNJ || "",
          "processo.titulo": processo.titulo || "",
          "autor.nome": processo.autor || "",
          "reu.nome": processo.reu || "",
          comarca: processo.comarca || "",
          vara: processo.vara || "",
        }));
      }
    }
  }, [formData.processId, processes]);

  const resetForm = () => {
    setFormData({
      titulo: "",
      processId: "",
      tipo: "peticao",
      conteudo: "",
      status: "rascunho",
    });
    setSelectedTemplate(null);
    setVariableValues({});
    setActiveTab("editor");
    setTemplateSearch("");
  };

  const handleAuthGoogle = async () => {
    try {
      if (!isGoogleConfigured) {
        toast.error("Google nÃ£o estÃ¡ configurado no ambiente (.env)");
        return;
      }

      const toastId = toast.loading("Inicializando Google Docs...");

      try {
        await googleDocsService.initialize();
        toast.success("Google Docs inicializado!", { id: toastId });
      } catch (initError) {
        const errorMsg = initError instanceof Error ? initError.message : "Erro ao inicializar Google Docs";
        let userMessage = errorMsg;

        if (errorMsg.includes("Timeout")) {
          userMessage = "Timeout ao carregar Google Docs. Verifique sua conexÃ£o e tente novamente.";
        } else if (errorMsg.includes("Failed to load")) {
          userMessage = "NÃ£o foi possÃ­vel carregar scripts do Google. Verifique sua conexÃ£o.";
        } else if (errorMsg.toLowerCase().includes("api key")) {
          userMessage = "Credenciais do Google invÃ¡lidas. Contate o suporte.";
        }

        toast.error(`Falha na inicializaÃ§Ã£o: ${userMessage}`, { id: toastId });
        console.error("[MinutasManager] Google Docs init error:", initError);
        return;
      }

      const success = await googleDocsService.authenticate();
      if (success) {
        setIsAuthenticated(true);
        toast.success("Autenticado com Google Docs!");
      } else {
        toast.error(googleDocsService.getLastError() || "Falha na autenticaÃ§Ã£o - verifique popups");
      }
    } catch (error) {
      const errorMsg = error instanceof Error ? error.message : "Erro desconhecido";
      toast.error(`Erro ao autenticar: ${errorMsg}`);
      console.error("[MinutasManager] Auth error:", error);
    }
  };

  const handleCreateMinuta = async () => {
    if (!formData.titulo || !formData.conteudo) {
      toast.error("Preencha tÃ­tulo e conteÃºdo");
      return;
    }

    try {
      const minutaInput: MinutaInput = {
        titulo: formData.titulo,
        processId: formData.processId || undefined,
        tipo: formData.tipo,
        conteudo: formData.conteudo,
        status: formData.status,
        autor: "current-user",
        criadoPorAgente: false,
      };

      const novaMinuta = createMinuta(minutaInput);
      setMinutas((current = []) => [...current, novaMinuta]);

      resetForm();
      setIsDialogOpen(false);
      toast.success("Minuta criada com sucesso!");
    } catch (error) {
      const errorMsg = error instanceof Error ? error.message : "Erro ao criar minuta";
      toast.error(errorMsg);
    }
  };

  const handleUpdateMinuta = async () => {
    if (!editingMinuta || !formData.titulo || !formData.conteudo) {
      toast.error("Preencha tÃ­tulo e conteÃºdo");
      return;
    }

    try {
      if (formData.status === "finalizada") {
        const validation = validateMinutaForFinalization({
          ...editingMinuta,
          titulo: formData.titulo,
          conteudo: formData.conteudo,
        });

        if (!validation.valid) {
          toast.error("Minuta nÃ£o pode ser finalizada", { description: validation.errors.join(", ") });
          return;
        }
      }

      const minutaAtualizada = updateMinuta(editingMinuta, {
        titulo: formData.titulo,
        processId: formData.processId || undefined,
        tipo: formData.tipo,
        conteudo: formData.conteudo,
        status: formData.status,
      });

      setMinutas((current = []) => current.map((m) => (m.id === editingMinuta.id ? minutaAtualizada : m)));

      if (minutaAtualizada.googleDocsId) {
        const syncSuccess = await googleDocsService.updateDocumentContent(
          minutaAtualizada.googleDocsId,
          minutaAtualizada.conteudo
        );
        toast[syncSuccess ? "success" : "warning"](
          syncSuccess ? "Minuta atualizada e sincronizada com Google Docs" : "Minuta atualizada, mas falha ao sincronizar com Google Docs"
        );
      } else {
        toast.success("Minuta atualizada com sucesso!");
      }

      resetForm();
      setIsDialogOpen(false);
      setEditingMinuta(null);
    } catch (error) {
      const errorMsg = error instanceof Error ? error.message : "Erro ao atualizar minuta";
      toast.error(errorMsg);
    }
  };

  const handleEditMinuta = (minuta: Minuta) => {
    setEditingMinuta(minuta);
    setFormData({
      titulo: minuta.titulo,
      processId: minuta.processId || "",
      tipo: minuta.tipo,
      conteudo: minuta.conteudo,
      status: minuta.status,
    });
    setIsDialogOpen(true);
  };

  const handleDeleteMinuta = (id: string) => {
    setMinutas((current = []) => current.filter((m) => m.id !== id));
    toast.success("Minuta excluÃ­da com sucesso!");
  };

  const handleApproveMinuta = (id: string) => {
    setMinutas((current = []) =>
      current.map((m) =>
        m.id === id ? { ...m, status: "finalizada" as Minuta["status"], atualizadoEm: new Date().toISOString() } : m
      )
    );
    toast.success("Minuta aprovada e finalizada!");
  };

  const handleDuplicateMinuta = (minuta: Minuta) => {
    const duplicada = createMinuta({
      titulo: `${minuta.titulo} (CÃ³pia)`,
      processId: minuta.processId,
      tipo: minuta.tipo,
      conteudo: minuta.conteudo,
      status: "rascunho",
      autor: "current-user",
      criadoPorAgente: false,
    });

    setMinutas((current = []) => [...current, duplicada]);
    toast.success("Minuta duplicada com sucesso!");
  };

  const handleExportPDF = (_minuta: Minuta) => toast.info("ExportaÃ§Ã£o para PDF em desenvolvimento");
  const handleExportDOCX = (_minuta: Minuta) => toast.info("ExportaÃ§Ã£o para DOCX em desenvolvimento");

  const handleOpenInGoogleDocs = async (minuta: Minuta) => {
    if (!isAuthenticated) {
      toast.error("Autentique com Google Docs primeiro");
      return;
    }

    try {
      if (minuta.googleDocsUrl) {
        openDocument(minuta.googleDocsUrl);
        toast.success("Abrindo documento no Google Docs...");
      } else {
        const result = await exportToGoogleDocs(minuta);
        if (result) {
          setMinutas((current = []) =>
            current.map((m) =>
              m.id === minuta.id
                ? { ...m, googleDocsId: result.docId, googleDocsUrl: result.url, ultimaSincronizacao: new Date().toISOString() }
                : m
            )
          );
          openDocument(result.url);
          toast.success("Documento criado e aberto no Google Docs!");
        }
      }
    } catch {
      toast.error("Erro ao abrir no Google Docs");
    }
  };

  const handleSyncFromGoogleDocs = async (minuta: Minuta) => {
    if (!minuta.googleDocsId) return;

    setIsSyncing(minuta.id);
    try {
      const success = await importFromGoogleDocs(minuta.id, minutas || [], setMinutas);
      if (success) toast.success("AlteraÃ§Ãµes importadas do Google Docs!");
    } catch {
      toast.error("Erro ao importar do Google Docs");
    } finally {
      setIsSyncing(null);
    }
  };

  const handleApplyTemplate = (template: DocumentTemplate) => {
    setSelectedTemplate(template);
    setFormData((prev) => ({
      ...prev,
      titulo: template.nome,
      tipo: template.categoria as Minuta["tipo"],
      conteudo: template.conteudo,
    }));

    const initialValues: Record<string, string> = {};
    template.variaveis.forEach((v) => (initialValues[v] = variableValues[v] || ""));
    setVariableValues(initialValues);

    setActiveTab("editor");
    toast.success(`Template "${template.nome}" aplicado!`);
  };

  const handleFillVariables = () => {
    const filled = replaceTemplateVariables(formData.conteudo, variableValues);
    setFormData((prev) => ({ ...prev, conteudo: filled }));
    toast.success("VariÃ¡veis preenchidas no documento!");
  };

  const handleAIGenerate = async (prompt: string): Promise<string> => {
    if (!isGeminiConfigured()) throw new Error("Gemini nÃ£o estÃ¡ configurado");

    const fullPrompt = `VocÃª Ã© um assistente jurÃ­dico especializado em redaÃ§Ã£o de documentos legais brasileiros.
Sua funÃ§Ã£o Ã© ajudar na criaÃ§Ã£o, ediÃ§Ã£o e melhoria de petiÃ§Ãµes, contratos, pareceres e outros documentos jurÃ­dicos.
Sempre use linguagem formal e tÃ©cnica apropriada. Cite legislaÃ§Ã£o e jurisprudÃªncia quando relevante.
Mantenha formataÃ§Ã£o HTML adequada para o editor (use <p>, <strong>, <em>, <ul>, <li>, <blockquote>).

${prompt}`;

    const response = await callGemini(fullPrompt);
    return response.text;
  };

  const handleAIStream = useCallback(
    async (
      prompt: string,
      callbacks: {
        onChunk: (chunk: string) => void;
        onComplete: () => void;
        onError: (error: Error) => void;
      }
    ) => {
      streamCallbacksRef.current = {
        onChunk: callbacks.onChunk,
        onComplete: callbacks.onComplete,
        onError: (err) => callbacks.onError(new Error(err)),
      };

      try {
        await streamChat([
          {
            role: "system",
            content: `VocÃª Ã© um assistente jurÃ­dico especializado em redaÃ§Ã£o de documentos legais brasileiros.
Sua funÃ§Ã£o Ã© ajudar na criaÃ§Ã£o, ediÃ§Ã£o e melhoria de petiÃ§Ãµes, contratos, pareceres e outros documentos jurÃ­dicos.
Sempre use linguagem formal e tÃ©cnica apropriada. Cite legislaÃ§Ã£o e jurisprudÃªncia quando relevante.
Mantenha formataÃ§Ã£o HTML adequada para o editor (use <p>, <strong>, <em>, <ul>, <li>, <blockquote>).`,
          },
          { role: "user", content: prompt },
        ]);
      } catch (err) {
        callbacks.onError(err instanceof Error ? err : new Error("Erro no streaming"));
      }
    },
    [streamChat]
  );

  // âœ… estilos tipados sem React namespace
  const getStatusStyle = (status: Minuta["status"]): CSSProperties => {
    const map: Record<Minuta["status"], string> = {
      rascunho: themeConfig.colors.alerta,
      "em-revisao": themeConfig.colors.info,
      "pendente-revisao": themeConfig.colors.alerta,
      finalizada: themeConfig.colors.sucesso,
      arquivada: "hsl(0, 0%, 45%)",
    };

    const base = map[status] || themeConfig.colors.info;
    return {
      color: base,
      backgroundColor: `${base.replace("hsl", "hsla").replace(")", ", 0.10)")}`,
      borderColor: `${base.replace("hsl", "hsla").replace(")", ", 0.20)")}`,
    };
  };

  const getStatusLabel = (status: Minuta["status"]) =>
    (
      {
        rascunho: "Rascunho",
        "em-revisao": "Em RevisÃ£o",
        "pendente-revisao": "Pendente RevisÃ£o",
        finalizada: "Finalizada",
        arquivada: "Arquivada",
      } as const
    )[status] || status;

  const getTipoLabel = (tipo: Minuta["tipo"]) =>
    (
      {
        peticao: "PetiÃ§Ã£o",
        contrato: "Contrato",
        parecer: "Parecer",
        recurso: "Recurso",
        procuracao: "ProcuraÃ§Ã£o",
        outro: "Outro",
      } as const
    )[tipo] || tipo;

  const getTintStyle = (base: string): CSSProperties => ({
    color: base,
    backgroundColor: `${base.replace("hsl", "hsla").replace(")", ", 0.10)")}`,
    borderColor: `${base.replace("hsl", "hsla").replace(")", ", 0.20)")}`,
  });

  const filteredMinutas = useMemo(() => {
    const q = minutaSearch.trim().toLowerCase();
    return (minutas || []).filter((m) => {
      const matchesSearch = !q || m.titulo.toLowerCase().includes(q);
      const matchesStatus = filterStatus === "all" || m.status === filterStatus;
      const matchesTipo = filterTipo === "all" || m.tipo === filterTipo;
      return matchesSearch && matchesStatus && matchesTipo;
    });
  }, [minutas, minutaSearch, filterStatus, filterTipo]);

  const minutasPendentes = useMemo(
    () => (minutas || []).filter((m) => m.status === "pendente-revisao" || m.criadoPorAgente),
    [minutas]
  );

  const unfilledVariables = useMemo(() => extractUnfilledVariables(formData.conteudo), [formData.conteudo]);

  return (
    <div className="p-6 space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between flex-wrap gap-4">
        <div>
          <h1 className="text-3xl font-bold text-foreground flex items-center gap-3">
            <FileText className="text-primary" />
            Editor de Minutas
          </h1>
          <p className="text-muted-foreground mt-1">
            Editor rico com IA (Gemini 2.5 Pro) e sincronizaÃ§Ã£o com Google Docs
          </p>
        </div>

        <div className="flex gap-3 flex-wrap">
          {(() => {
            if (!isGoogleConfigured) {
              return (
                <Badge variant="outline" style={getTintStyle(themeConfig.colors.alerta)} className="px-4 py-2">
                  <AlertTriangle className="mr-2 h-4 w-4" />
                  Google nÃ£o configurado
                </Badge>
              );
            }
            if (!isAuthenticated) {
              return (
                <Button onClick={handleAuthGoogle} variant="outline">
                  <FileText className="mr-2" />
                  Conectar Google Docs
                </Button>
              );
            }
            return (
              <Badge style={getTintStyle(themeConfig.colors.sucesso)} className="px-4 py-2">
                <FileText className="mr-2" />
                Google Conectado
              </Badge>
            );
          })()}

          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
            <DialogTrigger asChild>
              <Button
                onClick={() => {
                  setEditingMinuta(null);
                  resetForm();
                }}
              >
                <Plus className="mr-2" />
                Nova Minuta
              </Button>
            </DialogTrigger>

            {/* âœ… Modal sem overflow-y-auto + scroll sÃ³ no corpo */}
            <DialogContent className="max-w-6xl max-h-[95vh] flex flex-col bg-card p-0 overflow-hidden">
              <div className="p-6 pb-3">
                <DialogHeader>
                  <DialogTitle className="flex items-center gap-2">
                    {editingMinuta ? (
                      <>
                        <Pencil />
                        Editar Minuta
                      </>
                    ) : (
                      <>
                        <Plus />
                        Nova Minuta
                      </>
                    )}
                  </DialogTitle>
                  <DialogDescriptionUI>
                    Use o editor rico para criar sua minuta. Use a IA para gerar conteÃºdo com Gemini 2.5 Pro.
                  </DialogDescriptionUI>
                </DialogHeader>
              </div>

              <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as any)} className="flex-1 flex flex-col overflow-hidden">
                <div className="px-6">
                  <TabsList className="grid w-full grid-cols-3">
                    <TabsTrigger value="editor">Editor</TabsTrigger>
                    <TabsTrigger value="templates">Templates</TabsTrigger>
                    <TabsTrigger value="variaveis">VariÃ¡veis</TabsTrigger>
                  </TabsList>
                </div>

                <div className="flex-1 overflow-hidden">
                  <ScrollArea className="h-full">
                    <div className="px-6 pb-6 pt-4">
                      <TabsContent value="editor" className="mt-0 space-y-4">
                        {/* Metadados */}
                        <Card className="border-muted">
                          <CardHeader className="py-4">
                            <CardTitle className="text-sm">Dados da minuta</CardTitle>
                            <CardDescription className="text-xs">
                              Defina tÃ­tulo, tipo, status e vinculaÃ§Ã£o (opcional)
                            </CardDescription>
                          </CardHeader>
                          <CardContent className="space-y-4">
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                              <div className="md:col-span-2">
                                <Label htmlFor="titulo">TÃ­tulo</Label>
                                <Input
                                  id="titulo"
                                  value={formData.titulo}
                                  onChange={(e) => setFormData((p) => ({ ...p, titulo: e.target.value }))}
                                  placeholder="Ex: PetiÃ§Ã£o Inicial - AÃ§Ã£o de CobranÃ§a"
                                />
                              </div>

                              <div>
                                <Label htmlFor="tipo">Tipo</Label>
                                <Select value={formData.tipo} onValueChange={(value) => setFormData((p) => ({ ...p, tipo: value as Minuta["tipo"] }))}>
                                  <SelectTrigger id="tipo">
                                    <SelectValue placeholder="Selecione..." />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="peticao">PetiÃ§Ã£o</SelectItem>
                                    <SelectItem value="contrato">Contrato</SelectItem>
                                    <SelectItem value="parecer">Parecer</SelectItem>
                                    <SelectItem value="recurso">Recurso</SelectItem>
                                    <SelectItem value="procuracao">ProcuraÃ§Ã£o</SelectItem>
                                    <SelectItem value="outro">Outro</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div>
                                <Label htmlFor="status">Status</Label>
                                <Select value={formData.status} onValueChange={(value) => setFormData((p) => ({ ...p, status: value as Minuta["status"] }))}>
                                  <SelectTrigger id="status">
                                    <SelectValue placeholder="Selecione..." />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="rascunho">Rascunho</SelectItem>
                                    <SelectItem value="em-revisao">Em RevisÃ£o</SelectItem>
                                    <SelectItem value="finalizada">Finalizada</SelectItem>
                                    <SelectItem value="arquivada">Arquivada</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>

                            <div>
                              <Label htmlFor="processo">Vincular a Processo (opcional)</Label>
                              <Select
                                value={formData.processId || "_none"}
                                onValueChange={(value) => setFormData((p) => ({ ...p, processId: value === "_none" ? "" : value }))}
                              >
                                <SelectTrigger id="processo">
                                  <SelectValue placeholder="Selecione um processo" />
                                </SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="_none">Nenhum</SelectItem>
                                  {(processes || []).map((p) => (
                                    <SelectItem key={p.id} value={p.id}>
                                      {p.numeroCNJ} - {p.titulo}
                                    </SelectItem>
                                  ))}
                                </SelectContent>
                              </Select>
                            </div>
                          </CardContent>
                        </Card>

                        {/* Editor */}
                        <Card className="border-muted">
                          <CardHeader className="py-4">
                            <CardTitle className="text-sm">ConteÃºdo</CardTitle>
                            <CardDescription className="text-xs">
                              Escreva ou gere com IA e depois refine com comandos
                            </CardDescription>
                          </CardHeader>
                          <CardContent>
                            <div className="min-h-[420px]">
                              <ProfessionalEditor
                                key={editingMinuta?.id || "new-minuta"}
                                content={formData.conteudo}
                                onChange={(content) => setFormData((p) => ({ ...p, conteudo: content }))}
                                onAIGenerate={handleAIGenerate}
                                onAIStream={handleAIStream}
                                variables={variableValues}
                                placeholder="Digite o conteÃºdo da minuta ou use a IA para gerar com Gemini..."
                                className="h-full min-h-[420px]"
                                showCollaboration={false}
                              />
                            </div>
                          </CardContent>
                        </Card>

                        {/* Comandos IA (mantidos) */}
                        <Card className="border-purple-500/30 bg-purple-50/50 dark:bg-purple-950/20">
                          <CardHeader className="py-3 px-4">
                            <CardTitle className="text-sm flex items-center gap-2">
                              <Bot className="h-4 w-4 text-purple-600" />
                              Comandos IA
                              {isAICommandLoading && (
                                <Badge variant="secondary" className="ml-2">
                                  <Loader2 className="h-3 w-3 mr-1 animate-spin" />
                                  Processando...
                                </Badge>
                              )}
                              {!canAIRequest && aiWaitTime > 0 && (
                                <Badge variant="outline" className="ml-2 text-orange-600 border-orange-500">
                                  <Clock className="h-3 w-3 mr-1" />
                                  Aguarde {Math.ceil(aiWaitTime / 1000)}s
                                </Badge>
                              )}
                            </CardTitle>
                            <CardDescription className="text-xs">Use os comandos abaixo para processar o texto com IA</CardDescription>
                          </CardHeader>
                          <CardContent className="py-2 px-4">
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                              <Button
                                variant="outline"
                                size="sm"
                                onClick={() => handleAICommand("continuar", "append")}
                                disabled={isAICommandLoading || !formData.conteudo.trim()}
                                className="flex flex-col items-center gap-1 h-auto py-3 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-950/30"
                              >
                                {activeAICommand === "continuar" ? (
                                  <Loader2 className="h-4 w-4 animate-spin text-purple-600" />
                                ) : (
                                  <Zap className="h-4 w-4 text-purple-600" />
                                )}
                                <span className="font-medium">Continuar</span>
                                <span className="text-[10px] text-muted-foreground text-center">Continua a escrita</span>
                              </Button>

                              <Button
                                variant="outline"
                                size="sm"
                                onClick={() => handleAICommand("expandir", "replace")}
                                disabled={isAICommandLoading || !formData.conteudo.trim()}
                                className="flex flex-col items-center gap-1 h-auto py-3 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-950/30"
                              >
                                {activeAICommand === "expandir" ? (
                                  <Loader2 className="h-4 w-4 animate-spin text-purple-600" />
                                ) : (
                                  <Expand className="h-4 w-4 text-purple-600" />
                                )}
                                <span className="font-medium">Expandir</span>
                                <span className="text-[10px] text-muted-foreground text-center">Desenvolve o texto</span>
                              </Button>

                              <Button
                                variant="outline"
                                size="sm"
                                onClick={() => handleAICommand("revisar", "replace")}
                                disabled={isAICommandLoading || !formData.conteudo.trim()}
                                className="flex flex-col items-center gap-1 h-auto py-3 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-950/30"
                              >
                                {activeAICommand === "revisar" ? (
                                  <Loader2 className="h-4 w-4 animate-spin text-purple-600" />
                                ) : (
                                  <Sparkles className="h-4 w-4 text-purple-600" />
                                )}
                                <span className="font-medium">Revisar</span>
                                <span className="text-[10px] text-muted-foreground text-center">Melhora gramÃ¡tica</span>
                              </Button>

                              <Button
                                variant="outline"
                                size="sm"
                                onClick={() => handleAICommand("formalizar", "replace")}
                                disabled={isAICommandLoading || !formData.conteudo.trim()}
                                className="flex flex-col items-center gap-1 h-auto py-3 hover:border-purple-500 hover:bg-purple-50 dark:hover:bg-purple-950/30"
                              >
                                {activeAICommand === "formalizar" ? (
                                  <Loader2 className="h-4 w-4 animate-spin text-purple-600" />
                                ) : (
                                  <Wand2 className="h-4 w-4 text-purple-600" />
                                )}
                                <span className="font-medium">Formalizar</span>
                                <span className="text-[10px] text-muted-foreground text-center">Linguagem jurÃ­dica</span>
                              </Button>
                            </div>
                          </CardContent>
                        </Card>

                        {unfilledVariables.length > 0 && (
                          <Alert style={getTintStyle(themeConfig.colors.alerta)}>
                            <AlertTriangle className="h-4 w-4" style={{ color: themeConfig.colors.alerta }} />
                            <AlertDescription style={{ color: themeConfig.colors.alerta }}>
                              <strong>{unfilledVariables.length} variÃ¡veis nÃ£o preenchidas:</strong>{" "}
                              {unfilledVariables.slice(0, 5).join(", ")}
                              {unfilledVariables.length > 5 && ` e mais ${unfilledVariables.length - 5}`}
                              <Button
                                variant="link"
                                size="sm"
                                className="ml-2"
                                style={{ color: themeConfig.colors.alerta }}
                                onClick={() => setActiveTab("variaveis")}
                              >
                                Preencher variÃ¡veis â†’
                              </Button>
                            </AlertDescription>
                          </Alert>
                        )}
                      </TabsContent>

                      <TabsContent value="templates" className="mt-0">
                        <div className="space-y-4">
                          <div className="relative">
                            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                            <Input
                              placeholder="Buscar templates..."
                              className="pl-9"
                              value={templateSearch}
                              onChange={(e) => setTemplateSearch(e.target.value)}
                            />
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            {documentTemplates
                              .filter((t) => {
                                const q = templateSearch.trim().toLowerCase();
                                return !q || t.nome.toLowerCase().includes(q) || t.categoria.toLowerCase().includes(q);
                              })
                              .map((template) => (
                                <Card
                                  key={template.id}
                                  className={`cursor-pointer transition-all hover:border-primary/50 ${
                                    selectedTemplate?.id === template.id ? "border-primary bg-primary/5" : ""
                                  }`}
                                  onClick={() => handleApplyTemplate(template)}
                                >
                                  <CardHeader className="p-4">
                                    <CardTitle className="text-sm flex items-center gap-2">
                                      <FolderOpen className="h-4 w-4" />
                                      {template.nome}
                                    </CardTitle>
                                    <CardDescription className="text-xs">{template.descricao}</CardDescription>
                                  </CardHeader>
                                  <CardContent className="p-4 pt-0">
                                    <div className="flex gap-2 flex-wrap">
                                      <Badge variant="outline" className="text-xs">
                                        {template.categoria}
                                      </Badge>
                                      <Badge variant="secondary" className="text-xs">
                                        {template.variaveis.length} variÃ¡veis
                                      </Badge>
                                    </div>
                                  </CardContent>
                                </Card>
                              ))}
                          </div>
                        </div>
                      </TabsContent>

                      <TabsContent value="variaveis" className="mt-0">
                        <div className="space-y-4">
                          <p className="text-sm text-muted-foreground">
                            Preencha as variÃ¡veis para substituir automaticamente no documento. Use o formato{" "}
                            <code className="bg-muted px-1 rounded">{"{{variavel}}"}</code>.
                          </p>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {(selectedTemplate?.variaveis || unfilledVariables).map((variable) => (
                              <div key={variable}>
                                <Label className="text-xs">{variable}</Label>
                                <Input
                                  value={variableValues[variable] || ""}
                                  onChange={(e) => setVariableValues((prev) => ({ ...prev, [variable]: e.target.value }))}
                                  placeholder={`Valor para ${variable}`}
                                />
                              </div>
                            ))}
                          </div>

                          <Button onClick={handleFillVariables} className="w-full">
                            <Sparkles className="mr-2" />
                            Aplicar VariÃ¡veis no Documento
                          </Button>
                        </div>
                      </TabsContent>
                    </div>
                  </ScrollArea>
                </div>
              </Tabs>

              <div className="p-6 pt-3 border-t flex justify-end gap-2">
                <Button
                  variant="outline"
                  onClick={() => {
                    setIsDialogOpen(false);
                    setEditingMinuta(null);
                  }}
                >
                  Cancelar
                </Button>
                <Button onClick={editingMinuta ? handleUpdateMinuta : handleCreateMinuta}>
                  {editingMinuta ? "Atualizar" : "Criar"} Minuta
                </Button>
              </div>
            </DialogContent>
          </Dialog>
        </div>
      </div>

      {/* Alertas de minutas pendentes */}
      {minutasPendentes.length > 0 && (
        <Alert className="border-orange-500/50 bg-orange-50 dark:bg-orange-950/20">
          <Bot className="h-4 w-4 text-orange-600" />
          <AlertDescription className="text-orange-800 dark:text-orange-200">
            <strong>{minutasPendentes.length} minuta(s) pendente(s) de revisÃ£o</strong> criada(s) pelos agentes IA.
            <div className="flex gap-2 mt-2 flex-wrap">
              {minutasPendentes.slice(0, 3).map((m) => (
                <Button
                  key={m.id}
                  variant="outline"
                  size="sm"
                  onClick={() => handleEditMinuta(m)}
                  className="text-orange-600 border-orange-500/50"
                >
                  <Eye className="mr-1 h-3 w-3" />
                  {m.titulo.substring(0, 20)}...
                </Button>
              ))}
            </div>
          </AlertDescription>
        </Alert>
      )}

      {/* Filtros e View Toggle */}
      <div className="flex gap-4 flex-wrap items-center">
        <div className="relative flex-1 max-w-sm">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
          <Input
            placeholder="Buscar minutas..."
            className="pl-9"
            value={minutaSearch}
            onChange={(e) => setMinutaSearch(e.target.value)}
          />
        </div>

        <Select value={filterStatus} onValueChange={setFilterStatus}>
          <SelectTrigger className="w-[150px]">
            <SelectValue placeholder="Status" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">Todos Status</SelectItem>
            <SelectItem value="rascunho">Rascunho</SelectItem>
            <SelectItem value="em-revisao">Em RevisÃ£o</SelectItem>
            <SelectItem value="pendente-revisao">Pendente RevisÃ£o</SelectItem>
            <SelectItem value="finalizada">Finalizada</SelectItem>
            <SelectItem value="arquivada">Arquivada</SelectItem>
          </SelectContent>
        </Select>

        <Select value={filterTipo} onValueChange={setFilterTipo}>
          <SelectTrigger className="w-[150px]">
            <SelectValue placeholder="Tipo" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">Todos Tipos</SelectItem>
            <SelectItem value="peticao">PetiÃ§Ã£o</SelectItem>
            <SelectItem value="contrato">Contrato</SelectItem>
            <SelectItem value="parecer">Parecer</SelectItem>
            <SelectItem value="recurso">Recurso</SelectItem>
            <SelectItem value="procuracao">ProcuraÃ§Ã£o</SelectItem>
            <SelectItem value="outro">Outro</SelectItem>
          </SelectContent>
        </Select>

        <Badge variant="secondary">{filteredMinutas.length} minuta(s)</Badge>

        <div className="flex gap-1 border rounded-lg p-1">
          <Button
            size="sm"
            variant={viewMode === "grid" ? "secondary" : "ghost"}
            onClick={() => setViewMode("grid")}
            className="px-3"
            aria-label="VisualizaÃ§Ã£o em grade"
            title="VisualizaÃ§Ã£o em grade"
          >
            <Grid3x3 className="h-4 w-4" />
          </Button>
          <Button
            size="sm"
            variant={viewMode === "list" ? "secondary" : "ghost"}
            onClick={() => setViewMode("list")}
            className="px-3"
            aria-label="VisualizaÃ§Ã£o em lista"
            title="VisualizaÃ§Ã£o em lista"
          >
            <List className="h-4 w-4" />
          </Button>
        </div>
      </div>

      {/* Lista de Minutas */}
      {filteredMinutas.length === 0 ? (
        <Card>
          <CardContent className="flex flex-col items-center justify-center py-12">
            <FileText size={64} className="text-muted-foreground mb-4" />
            <p className="text-muted-foreground text-center">
              {minutaSearch || filterStatus !== "all" || filterTipo !== "all"
                ? "Nenhuma minuta encontrada com os filtros aplicados."
                : "Nenhuma minuta criada ainda."}
              <br />
              Clique em &quot;Nova Minuta&quot; para comeÃ§ar.
            </p>
          </CardContent>
        </Card>
      ) : (
        <div
          className={
            viewMode === "grid"
              ? "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
              : "grid gap-4"
          }
          data-testid="minutas-container"
        >
          {filteredMinutas.map((minuta) => {
            const processo = (processes || []).find((p) => p.id === minuta.processId);

            return (
              <Card
                key={minuta.id}
                className={`transition-all hover:shadow-md ${minuta.criadoPorAgente ? "border-orange-500/30" : ""}`}
              >
                <CardHeader>
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <CardTitle className="flex items-center gap-2 text-base">
                        <FileText className="text-primary h-4 w-4" />
                        {minuta.titulo}
                        {minuta.criadoPorAgente && (
                          <Badge style={getTintStyle(themeConfig.colors.info)}>
                            <Bot className="mr-1 h-3 w-3" />
                            IA
                          </Badge>
                        )}
                      </CardTitle>

                      <CardDescription className="mt-2 flex items-center gap-2 flex-wrap">
                        <Badge style={getStatusStyle(minuta.status)}>{getStatusLabel(minuta.status)}</Badge>
                        <Badge variant="outline">{getTipoLabel(minuta.tipo)}</Badge>
                        {processo && (
                          <Badge variant="secondary" className="text-xs">
                            {processo.numeroCNJ}
                          </Badge>
                        )}
                        {minuta.googleDocsId && (
                          <Badge style={getTintStyle(themeConfig.colors.info)}>
                            <FileText className="mr-1 h-3 w-3" />
                            Google Docs
                          </Badge>
                        )}
                      </CardDescription>
                    </div>
                  </div>
                </CardHeader>

                <CardContent>
                  <div className="space-y-4">
                    {viewMode === "grid" && (
                      <div
                        className="text-sm text-muted-foreground bg-muted/50 p-4 rounded-lg max-h-24 overflow-hidden prose prose-sm dark:prose-invert line-clamp-3"
                        dangerouslySetInnerHTML={{
                          __html:
                            minuta.conteudo.substring(0, 200) + (minuta.conteudo.length > 200 ? "..." : ""),
                        }}
                      />
                    )}

                    <div className="flex items-center gap-4 text-xs text-muted-foreground">
                      <span className="flex items-center gap-1">
                        <Clock className="h-3 w-3" />
                        {new Date(minuta.atualizadoEm).toLocaleDateString("pt-BR")}
                      </span>
                      {minuta.ultimaSincronizacao && (
                        <span className="flex items-center gap-1">
                          <RefreshCw className="h-3 w-3" />
                          Sync
                        </span>
                      )}
                    </div>

                    <div className="flex gap-2 flex-wrap">
                      <Button size="sm" variant="outline" onClick={() => handleEditMinuta(minuta)}>
                        <Pencil className="mr-2 h-4 w-4" />
                        Editar
                      </Button>

                      {minuta.status !== "finalizada" && (
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => handleApproveMinuta(minuta.id)}
                          style={{
                            color: themeConfig.colors.sucesso,
                            borderColor: `${themeConfig.colors.sucesso.replace("hsl", "hsla").replace(")", ", 0.50)")}`,
                          }}
                          className="hover:opacity-80"
                        >
                          <CheckCircle className="mr-2 h-4 w-4" />
                          Aprovar
                        </Button>
                      )}

                      <Button size="sm" variant="outline" onClick={() => handleDuplicateMinuta(minuta)}>
                        <Copy className="mr-2 h-4 w-4" />
                        Duplicar
                      </Button>

                      <Popover>
                        <PopoverTrigger asChild>
                          <Button size="sm" variant="outline">
                            <Download className="mr-2 h-4 w-4" />
                            Exportar
                            <ChevronDown className="ml-1 h-3 w-3" />
                          </Button>
                        </PopoverTrigger>
                        <PopoverContent className="w-auto p-2">
                          <div className="flex flex-col gap-1">
                            <Button variant="ghost" size="sm" onClick={() => handleExportPDF(minuta)} className="justify-start">
                              <FileText className="mr-2 h-4 w-4" /> Exportar PDF
                            </Button>
                            <Button variant="ghost" size="sm" onClick={() => handleExportDOCX(minuta)} className="justify-start">
                              <FileText className="mr-2 h-4 w-4" /> Exportar DOC
                            </Button>
                            <Button
                              variant="ghost"
                              size="sm"
                              onClick={() => handleOpenInGoogleDocs(minuta)}
                              disabled={!isAuthenticated}
                              className="justify-start"
                            >
                              <FileText className="mr-2 h-4 w-4" />
                              {minuta.googleDocsUrl ? "Abrir no" : "Criar no"} Google Docs
                            </Button>
                          </div>
                        </PopoverContent>
                      </Popover>

                      {minuta.googleDocsId && (
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => handleSyncFromGoogleDocs(minuta)}
                          disabled={isSyncing === minuta.id}
                          title="Importar alteraÃ§Ãµes do Google Docs"
                        >
                          <RefreshCw className={`mr-2 h-4 w-4 ${isSyncing === minuta.id ? "animate-spin" : ""}`} />
                          {isSyncing === minuta.id ? "Importando..." : "Importar"}
                        </Button>
                      )}

                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => handleDeleteMinuta(minuta.id)}
                        className="text-destructive hover:text-destructive ml-auto"
                      >
                        <Trash className="mr-2 h-4 w-4" />
                        Excluir
                      </Button>
                    </div>
                  </div>
                </CardContent>
              </Card>
            );
          })}
        </div>
      )}
    </div>
  );
}
O que isso resolve â€œna prÃ¡ticaâ€ (seus prints)
Modal fica profissional, sem scroll bugado e sem â€œtoolbar flutuanteâ€

Editor ganha hierarquia visual (Dados â†’ ConteÃºdo â†’ IA)

Busca de templates nÃ£o estraga a busca de minutas

Remove o bug do React.CSSProperties

processId fica limpo e consistente

PrÃ³ximo arquivo ideal pra eu corrigir na sequÃªncia
Agora manda o ProfessionalEditor.tsx (CKEditor).
Ã‰ nele que dÃ¡ pra deixar a toolbar ainda mais â€œPJe-likeâ€ e com CTA de IA mais evidente.

VocÃª disse:
/**
 * ProfessionalEditor - Editor de documentos com CKEditor 5
 *
 * Features:
 * - UI profissional igual Word/Google Docs
 * - ColaboraÃ§Ã£o humano/IA com pausa automÃ¡tica
 * - Track Changes nativo do CKEditor
 * - ComentÃ¡rios e revisÃµes
 * - Export para Word/PDF
 * - AparÃªncia de pÃ¡gina A4
 * - Slash commands para IA (/gerar-minuta, /djen, etc)
 * - IntegraÃ§Ã£o com DJEN e dados de processos
 */

import { CKEditor } from "@ckeditor/ckeditor5-react";
import {
  AccessibilityHelp,
  Autoformat,
  AutoLink,
  Autosave,
  BalloonToolbar,
  BlockQuote,
  Bold,
  ClassicEditor,
  Code,
  Essentials,
  FindAndReplace,
  FontBackgroundColor,
  FontColor,
  FontFamily,
  FontSize,
  Heading,
  Highlight,
  HorizontalLine,
  Indent,
  IndentBlock,
  Italic,
  Link,
  List,
  ListProperties,
  Paragraph,
  SelectAll,
  SpecialCharacters,
  SpecialCharactersEssentials,
  Strikethrough,
  Subscript,
  Superscript,
  Table,
  TableCaption,
  TableCellProperties,
  TableColumnResize,
  TableProperties,
  TableToolbar,
  TextTransformation,
  TodoList,
  Underline,
  Undo,
  WordCount,
  type EditorConfig,
} from "ckeditor5";

import "ckeditor5/ckeditor5.css";
import "./professional-editor.scss";

import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Separator } from "@/components/ui/separator";
import { useEditorAI, EDITOR_SLASH_COMMANDS } from "@/hooks/use-editor-ai";
import { cn } from "@/lib/utils";
import {
  Bot,
  ChevronDown,
  Expand,
  FileText,
  Loader2,
  Sparkles,
  User,
  Wand2,
  Zap,
} from "lucide-react";
import { useCallback, useEffect, useRef, useState } from "react";
import { toast } from "sonner";

// ===========================
// Types
// ===========================

interface DJENPublication {
  id?: string;
  conteudo?: string;
  dataDisponibilizacao?: string;
  orgaoJulgador?: string;
  numeroProcesso?: string;
}

interface ProcessData {
  numero?: string;
  partes?: string;
  vara?: string;
  classe?: string;
  [key: string]: unknown;
}

// ===========================
// Props Interface
// ===========================

interface ProfessionalEditorProps {
  readonly content: string;
  readonly onChange: (content: string) => void;
  readonly placeholder?: string;
  readonly className?: string;
  readonly readOnly?: boolean;
  readonly onAIGenerate?: (prompt: string) => Promise<string>;
  readonly onAIStream?: (
    prompt: string,
    callbacks: {
      onChunk: (chunk: string) => void;
      onComplete: () => void;
      onError: (error: Error) => void;
    }
  ) => Promise<void>;
  readonly variables?: Record<string, string>;
  readonly showCollaboration?: boolean;
  readonly djenData?: DJENPublication[];
  readonly processData?: ProcessData;
  readonly documentType?: string;
}

// ===========================
// AI Constants
// ===========================

const AI_QUICK_COMMANDS = [
  {
    label: "Continuar",
    icon: Zap,
    prompt: "Continue escrevendo o texto de forma natural e profissional:",
  },
  {
    label: "Expandir",
    icon: Expand,
    prompt: "Expanda e desenvolva o seguinte texto de forma mais detalhada:",
  },
  {
    label: "Revisar",
    icon: Sparkles,
    prompt: "Revise e melhore a redaÃ§Ã£o do seguinte texto mantendo o significado:",
  },
  {
    label: "Formalizar",
    icon: Wand2,
    prompt: "Reescreva o seguinte texto em linguagem jurÃ­dica formal:",
  },
] as const;

// ===========================
// Helper Functions
// ===========================

function countWords(text: string): number {
  return text.trim().length === 0
    ? 0
    : text
        .trim()
        .split(/\s+/)
        .filter((w) => w.length > 0).length;
}

// ===========================
// Main Component
// ===========================

export function ProfessionalEditor({
  content,
  onChange,
  placeholder = "Digite seu texto aqui...",
  className,
  readOnly = false,
  onAIGenerate,
  onAIStream,
  variables = {},
  showCollaboration = true,
  djenData = [],
  processData,
  documentType,
}: ProfessionalEditorProps) {
  const editorRef = useRef<ClassicEditor | null>(null);
  const lastUserInputRef = useRef<number>(Date.now());
  const inactivityTimerRef = useRef<NodeJS.Timeout | null>(null);

  // State
  const [isAIActive, setIsAIActive] = useState(false);
  const [isUserTyping, setIsUserTyping] = useState(false);
  const [isAILoading, setIsAILoading] = useState(false);
  const [isStreaming, setIsStreaming] = useState(false);
  const [aiPrompt, setAiPrompt] = useState("");
  const [wordCount, setWordCount] = useState(0);
  const [charCount, setCharCount] = useState(0);
  const [isEditorReady, setIsEditorReady] = useState(false);
  const [showSlashMenu, setShowSlashMenu] = useState(false);
  const [slashFilter, setSlashFilter] = useState("");
  const [slashMenuPosition, setSlashMenuPosition] = useState({ top: 0, left: 0 });

  // Hook de IA para editor
  const {
    isLoading: isEditorAILoading,
    executeCommand,
    generateMinuta,
    loadCommands,
  } = useEditorAI();

  // Carregar comandos ao montar
  useEffect(() => {
    loadCommands();
  }, [loadCommands]);

  // ===========================
  // CKEditor Configuration
  // ===========================

  const editorConfig: EditorConfig = {
    licenseKey: "GPL",
    toolbar: {
      items: [
        "undo",
        "redo",
        "|",
        "heading",
        "|",
        "fontSize",
        "fontFamily",
        "fontColor",
        "fontBackgroundColor",
        "|",
        "bold",
        "italic",
        "underline",
        "strikethrough",
        "subscript",
        "superscript",
        "code",
        "|",
        "link",
        "insertTable",
        "blockQuote",
        "horizontalLine",
        "specialCharacters",
        "|",
        "bulletedList",
        "numberedList",
        "todoList",
        "outdent",
        "indent",
      ],
      shouldNotGroupWhenFull: false,
    },
    plugins: [
      AccessibilityHelp,
      Autoformat,
      AutoLink,
      Autosave,
      BalloonToolbar,
      BlockQuote,
      Bold,
      Code,
      Essentials,
      FindAndReplace,
      FontBackgroundColor,
      FontColor,
      FontFamily,
      FontSize,
      Heading,
      Highlight,
      HorizontalLine,
      Indent,
      IndentBlock,
      Italic,
      Link,
      List,
      ListProperties,
      Paragraph,
      SelectAll,
      SpecialCharacters,
      SpecialCharactersEssentials,
      Strikethrough,
      Subscript,
      Superscript,
      Table,
      TableCaption,
      TableCellProperties,
      TableColumnResize,
      TableProperties,
      TableToolbar,
      TextTransformation,
      TodoList,
      Underline,
      Undo,
      WordCount,
    ],
    balloonToolbar: ["bold", "italic", "|", "link"],
    fontFamily: {
      supportAllValues: true,
      options: [
        "default",
        "Arial, Helvetica, sans-serif",
        "Courier New, Courier, monospace",
        "Georgia, serif",
        "Lucida Sans Unicode, Lucida Grande, sans-serif",
        "Tahoma, Geneva, sans-serif",
        "Times New Roman, Times, serif",
        "Trebuchet MS, Helvetica, sans-serif",
        "Verdana, Geneva, sans-serif",
      ],
    },
    fontSize: {
      options: [10, 12, "default", 16, 18, 20, 24, 28, 32],
      supportAllValues: true,
    },
    heading: {
      options: [
        { model: "paragraph", title: "Paragraph", class: "ck-heading_paragraph" },
        { model: "heading1", view: "h1", title: "Heading 1", class: "ck-heading_heading1" },
        { model: "heading2", view: "h2", title: "Heading 2", class: "ck-heading_heading2" },
        { model: "heading3", view: "h3", title: "Heading 3", class: "ck-heading_heading3" },
        { model: "heading4", view: "h4", title: "Heading 4", class: "ck-heading_heading4" },
      ],
    },
    link: {
      addTargetToExternalLinks: true,
      defaultProtocol: "https://",
      decorators: {
        toggleDownloadable: {
          mode: "manual",
          label: "Downloadable",
          attributes: {
            download: "file",
          },
        },
      },
    },
    list: {
      properties: {
        styles: true,
        startIndex: true,
        reversed: true,
      },
    },
    placeholder,
    table: {
      contentToolbar: [
        "tableColumn",
        "tableRow",
        "mergeTableCells",
        "tableProperties",
        "tableCellProperties",
      ],
    },
  };

  // ===========================
  // Human + AI Collaboration Logic
  // ===========================

  const handleUserInput = useCallback(() => {
    lastUserInputRef.current = Date.now();
    setIsUserTyping(true);

    if (isAIActive) {
      setIsAIActive(false);
    }

    if (inactivityTimerRef.current) {
      clearTimeout(inactivityTimerRef.current);
    }

    inactivityTimerRef.current = setTimeout(() => {
      setIsUserTyping(false);
    }, 3000);
  }, [isAIActive]);

  // Cleanup timer
  useEffect(() => {
    return () => {
      if (inactivityTimerRef.current) {
        clearTimeout(inactivityTimerRef.current);
      }
    };
  }, []);

  // ===========================
  // AI Functions
  // ===========================

  const replaceVariables = useCallback(
    (text: string) => {
      let result = text;
      Object.entries(variables).forEach(([key, value]) => {
        const regex = new RegExp(String.raw\{\{\s*${key}\s*\}\}, "g");
        result = result.replaceAll(regex, value);
      });
      return result;
    },
    [variables]
  );

  const runAIStreaming = useCallback(
    async (prompt: string) => {
      const editor = editorRef.current;
      if (!editor || !onAIStream) return;

      setIsAIActive(true);
      setIsStreaming(true);

      try {
        await onAIStream(prompt, {
          onChunk: (chunk: string) => {
            if (isUserTyping) return;

            const viewFragment = editor.data.processor.toView(chunk);
            const modelFragment = editor.data.toModel(viewFragment);
            editor.model.insertContent(modelFragment);
          },
          onComplete: () => {
            setIsStreaming(false);
            setIsAIActive(false);
            setAiPrompt("");
            toast.success("IA finalizou a redaÃ§Ã£o");
          },
          onError: (error: Error) => {
            console.error("Erro no streaming:", error);
            toast.error("Erro no streaming de IA");
            setIsStreaming(false);
            setIsAIActive(false);
          },
        });
      } catch (error) {
        console.error("Erro ao iniciar streaming:", error);
        setIsStreaming(false);
        setIsAIActive(false);
      }
    },
    [onAIStream, isUserTyping]
  );

  const handleQuickAI = useCallback(
    async (command: (typeof AI_QUICK_COMMANDS)[number]) => {
      const editor = editorRef.current;
      if (!editor) return;

      const selectedText = editor.getData();
      const fullPrompt = ${command.prompt}\n\n${selectedText};

      if (onAIStream) {
        await runAIStreaming(fullPrompt);
      } else if (onAIGenerate) {
        setIsAILoading(true);
        try {
          const result = await onAIGenerate(fullPrompt);
          const processed = replaceVariables(result);
          editor.setData(processed);
          toast.success(IA aplicou: ${command.label});
        } catch {
          toast.error("Erro ao processar comando de IA");
        } finally {
          setIsAILoading(false);
        }
      }
    },
    [onAIGenerate, onAIStream, replaceVariables, runAIStreaming]
  );

  // ===========================
  // Slash Command Handler
  // ===========================

  const handleSlashCommand = useCallback(
    async (command: string, customPrompt: string = "") => {
      const editor = editorRef.current;
      if (!editor) return;

      setIsAIActive(true);
      setShowSlashMenu(false);

      try {
        // Obter conteÃºdo atual para contexto
        const currentHtml = editor.getData();
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = currentHtml;
        const plainText = tempDiv.textContent || tempDiv.innerText || "";

        // Remover o texto do comando slash usando a API do modelo (preserva formataÃ§Ã£o)
        editor.model.change((writer) => {
          const selection = editor.model.document.selection;
          const position = selection.getLastPosition();

          if (position) {
            // Encontrar o slash command no final do texto
            const slashMatch = plainText.match(/\/([a-z-]*)$/i);
            if (slashMatch) {
              const charsToDelete = slashMatch[0].length;
              // Mover para trÃ¡s e deletar os caracteres do comando
              const range = writer.createRange(position.getShiftedBy(-charsToDelete), position);
              writer.remove(range);
            }
          }
        });

        const prompt =
          customPrompt || Gere conteÃºdo jurÃ­dico profissional para ${command.replace("/", "")};
        const contextWithoutSlash = plainText.replace(/\/[a-z-]*$/i, "").trim();

        const result = await executeCommand({
          command,
          prompt,
          context: contextWithoutSlash,
          djenData,
          processData,
        });

        if (result.success && result.content) {
          const viewFragment = editor.data.processor.toView(result.content);
          const modelFragment = editor.data.toModel(viewFragment);
          editor.model.insertContent(modelFragment);
          toast.success(Comando ${command} executado);
        } else {
          toast.error(result.error || "Erro ao executar comando");
        }
      } catch (error) {
        console.error("Erro no slash command:", error);
        toast.error("Erro ao executar comando de IA");
      } finally {
        setIsAIActive(false);
      }
    },
    [executeCommand, djenData, processData]
  );

  const handleGenerateMinutaWithContext = useCallback(
    async (prompt: string) => {
      const editor = editorRef.current;
      if (!editor) return;

      setIsAIActive(true);

      try {
        const currentContent = editor.getData();
        const result = await generateMinuta({
          prompt,
          context: currentContent,
          djenData,
          processData,
          documentType,
          existingContent: currentContent,
        });

        if (result.success && result.content) {
          editor.setData(result.content);
          toast.success("Minuta gerada com sucesso");
        } else {
          toast.error(result.error || "Erro ao gerar minuta");
        }
      } catch (error) {
        console.error("Erro ao gerar minuta:", error);
        toast.error("Erro ao gerar minuta");
      } finally {
        setIsAIActive(false);
      }
    },
    [generateMinuta, djenData, processData, documentType]
  );

  // Detectar "/" no inÃ­cio de uma linha e posicionar menu prÃ³ximo ao cursor
  const checkForSlashCommand = useCallback((plainText: string, editor: ClassicEditor) => {
    const lines = plainText.split("\n");
    const lastLine = lines[lines.length - 1] || "";

    // Procurar por comando slash no final do texto
    const slashMatch = lastLine.match(/\/([a-z-]*)$/i);

    if (slashMatch) {
      const filter = slashMatch[1].toLowerCase();
      setSlashFilter(filter);
      setShowSlashMenu(true);

      // Posicionar o menu prÃ³ximo Ã  seleÃ§Ã£o atual
      try {
        const selection = editor.editing.view.document.selection;
        const viewRange = selection.getFirstRange();

        if (viewRange) {
          const domRange = editor.editing.view.domConverter.viewRangeToDom(viewRange);
          if (domRange) {
            const rect = domRange.getBoundingClientRect();
            setSlashMenuPosition({
              top: rect.bottom + window.scrollY + 5,
              left: rect.left + window.scrollX,
            });
            return;
          }
        }

        // Fallback: posiÃ§Ã£o relativa ao editor
        const editorElement = editor.ui.view.element;
        if (editorElement) {
          const rect = editorElement.getBoundingClientRect();
          setSlashMenuPosition({
            top: rect.top + window.scrollY + 100,
            left: rect.left + window.scrollX + 50,
          });
        }
      } catch {
        setSlashMenuPosition({ top: 200, left: 100 });
      }
    } else {
      setShowSlashMenu(false);
      setSlashFilter("");
    }
  }, []);

  // Filtrar comandos slash
  const filteredSlashCommands = EDITOR_SLASH_COMMANDS.filter(
    (cmd) =>
      cmd.command.toLowerCase().includes(slashFilter) ||
      cmd.label.toLowerCase().includes(slashFilter)
  );

  const handleAIGenerate = useCallback(async () => {
    const editor = editorRef.current;
    if (!aiPrompt.trim() || !editor) return;

    if (onAIStream) {
      await runAIStreaming(aiPrompt);
    } else if (onAIGenerate) {
      setIsAILoading(true);
      try {
        const result = await onAIGenerate(aiPrompt);
        const processed = replaceVariables(result);

        const viewFragment = editor.data.processor.toView(processed);
        const modelFragment = editor.data.toModel(viewFragment);
        editor.model.insertContent(modelFragment);

        setAiPrompt("");
        toast.success("Texto gerado com IA");
      } catch {
        toast.error("Erro ao gerar texto");
      } finally {
        setIsAILoading(false);
      }
    }
  }, [aiPrompt, onAIGenerate, onAIStream, replaceVariables, runAIStreaming]);

  // ===========================
  // Render
  // ===========================

  return (
    <div className={cn("professional-editor-wrapper", className)}>
      {/* AI Toolbar */}
      <div className="ai-toolbar">
        <Popover>
          <PopoverTrigger asChild>
            <Button
              variant={isAIActive || isStreaming ? "default" : "outline"}
              size="sm"
              title="Comandos de IA"
            >
              {isAIActive || isStreaming ? (
                <Loader2 className="h-4 w-4 animate-spin" />
              ) : (
                <Bot className="h-4 w-4" />
              )}
              <span className="ml-2">Assistente IA</span>
              <ChevronDown className="h-3 w-3 ml-1" />
            </Button>
          </PopoverTrigger>
          <PopoverContent className="w-80" align="start">
            <div className="space-y-4">
              <div className="space-y-2">
                <h4 className="font-medium text-sm">Comandos RÃ¡pidos</h4>
                <div className="grid grid-cols-2 gap-2">
                  {AI_QUICK_COMMANDS.map((cmd) => (
                    <Button
                      key={cmd.label}
                      variant="outline"
                      size="sm"
                      onClick={() => handleQuickAI(cmd)}
                      disabled={isStreaming || isAILoading || !isEditorReady}
                      className="justify-start"
                    >
                      <cmd.icon className="h-3 w-3 mr-2" />
                      {cmd.label}
                    </Button>
                  ))}
                </div>
              </div>

              <Separator />

              <div className="space-y-2">
                <label className="text-sm font-medium">Gerar com IA</label>
                <Input
                  placeholder="Digite o que deseja..."
                  value={aiPrompt}
                  onChange={(e) => setAiPrompt(e.target.value)}
                  onKeyDown={(e) => e.key === "Enter" && handleAIGenerate()}
                />
                <Button
                  className="w-full"
                  onClick={handleAIGenerate}
                  disabled={!aiPrompt.trim() || isAILoading || isStreaming || !isEditorReady}
                >
                  {isAILoading || isStreaming ? (
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                  ) : (
                    <Zap className="h-4 w-4 mr-2" />
                  )}
                  Gerar
                </Button>
              </div>
            </div>
          </PopoverContent>
        </Popover>

        {/* Slash Commands Dropdown */}
        <Popover>
          <PopoverTrigger asChild>
            <Button variant="ghost" size="sm" title="Comandos Slash">
              <FileText className="h-4 w-4" />
              <span className="ml-2 hidden sm:inline">Comandos /</span>
            </Button>
          </PopoverTrigger>
          <PopoverContent className="w-72" align="start">
            <div className="space-y-2">
              <h4 className="font-medium text-sm">Comandos Slash</h4>
              <p className="text-xs text-muted-foreground">
                Digite "/" no editor para acessar rapidamente
              </p>
              <ScrollArea className="h-48">
                <div className="space-y-1">
                  {EDITOR_SLASH_COMMANDS.map((cmd) => (
                    <Button
                      key={cmd.command}
                      variant="ghost"
                      size="sm"
                      className="w-full justify-start text-left"
                      onClick={() => handleSlashCommand(cmd.command)}
                      disabled={isAIActive || isEditorAILoading}
                    >
                      <span className="mr-2">{cmd.icon}</span>
                      <div className="flex-1 min-w-0">
                        <div className="font-medium text-sm">{cmd.label}</div>
                        <div className="text-xs text-muted-foreground truncate">
                          {cmd.description}
                        </div>
                      </div>
                    </Button>
                  ))}
                </div>
              </ScrollArea>
            </div>
          </PopoverContent>
        </Popover>

        {/* DJEN Context Indicator */}
        {djenData && djenData.length > 0 && (
          <Badge variant="secondary" className="ml-2">
            {djenData.length} pub. DJEN
          </Badge>
        )}

        {/* Collaboration Indicator */}
        {showCollaboration && (
          <div className="ml-auto flex items-center gap-2">
            {isUserTyping && (
              <Badge variant="default" className="bg-blue-500">
                <User className="h-3 w-3 mr-1" />
                VocÃª estÃ¡ editando
              </Badge>
            )}
            {(isAIActive || isEditorAILoading) && !isUserTyping && (
              <Badge variant="default" className="bg-purple-500">
                <Bot className="h-3 w-3 mr-1" />
                IA escrevendo...
              </Badge>
            )}
          </div>
        )}
      </div>

      {/* Floating Slash Command Menu */}
      {showSlashMenu && filteredSlashCommands.length > 0 && (
        <div
          className="absolute z-50 bg-background border rounded-lg shadow-lg p-2 w-64"
          style={{ top: slashMenuPosition.top, left: slashMenuPosition.left }}
        >
          <ScrollArea className="max-h-48">
            {filteredSlashCommands.map((cmd) => (
              <Button
                key={cmd.command}
                variant="ghost"
                size="sm"
                className="w-full justify-start text-left"
                onClick={() => handleSlashCommand(cmd.command)}
              >
                <span className="mr-2">{cmd.icon}</span>
                <span className="font-medium">{cmd.label}</span>
              </Button>
            ))}
          </ScrollArea>
        </div>
      )}

      {/* CKEditor */}
      <div className="professional-editor-page">
        <CKEditor
          editor={ClassicEditor}
          config={editorConfig}
          data={content}
          disabled={readOnly}
          onReady={(editor) => {
            editorRef.current = editor;
            setIsEditorReady(true);

            const htmlData = editor.getData();
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = htmlData;
            const plainText = tempDiv.textContent || tempDiv.innerText || "";
            setWordCount(countWords(plainText));
            setCharCount(plainText.length);
          }}
          onChange={(_event, editor) => {
            const htmlData = editor.getData();
            onChange(htmlData);

            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = htmlData;
            const plainText = tempDiv.textContent || tempDiv.innerText || "";
            setWordCount(countWords(plainText));
            setCharCount(plainText.length);

            // Detectar slash commands enquanto digita
            checkForSlashCommand(plainText, editor);

            if (!readOnly) {
              handleUserInput();
            }
          }}
          onError={(error, { willEditorRestart }) => {
            console.error("CKEditor error:", error);
            if (willEditorRestart) {
              editorRef.current = null;
            }
          }}
        />
      </div>

      {/* Footer */}
      <div className="professional-editor-footer">
        <div className="text-xs text-muted-foreground">
          {wordCount} {wordCount === 1 ? "palavra" : "palavras"} â€¢ {charCount}{" "}
          {charCount === 1 ? "caractere" : "caracteres"}
        </div>
      </div>
    </div>
  );
}
O ChatGPT disse:

Pensou por 21s
Perfeito â€” jÃ¡ deu pra sacar pelos prints o problema principal: seus modais estÃ£o com â€œscroll duploâ€ (nested scroll) e o conteÃºdo (Tabs + Editor) estÃ¡ brigando com max-h, overflow-y-auto e overflow-hidden. Resultado: aquela barra de rolagem fininha dentro do modal (igual no print do Dashboard) e sensaÃ§Ã£o de UI â€œpresaâ€.

TambÃ©m encontrei 2 bugs objetivos no seu cÃ³digo.

1) AnÃ¡lise dos prints (o que estÃ¡ errado)
Print â€œNova Minutaâ€
O modal estÃ¡ com: DialogContent max-h-[95vh] overflow-y-auto

E dentro dele vocÃª tem Tabs/Ã¡reas com overflow-hidden + ScrollArea em algumas tabs.

ğŸ“Œ Isso cria scroll no modal + scroll interno (Ã s vezes 2 ou 3). O browser escolhe uma Ã¡rea pra rolar (geralmente a menor), e fica aquela barra fininha horrÃ­vel.

Print â€œImportar Processo via Screenshot/Imagemâ€
Exatamente o mesmo sintoma: modal rolando dentro de um container interno.

âœ… SoluÃ§Ã£o de UI: 1 scroll sÃ³.

Header fixo

Footer fixo

ConteÃºdo central (Tabs) Ã© o Ãºnico que rola

2) Bug 1 (grave): vocÃª estÃ¡ usando a ENV errada para Google
No MinutasManager:

const GOOGLE_API_KEY = import.meta.env.VITE_GEMINI_API_KEY || "";
Isso estÃ¡ errado: Google Docs API key nÃ£o Ã© a Gemini key.
EntÃ£o seu â€œGoogle nÃ£o configuradoâ€ pode estar aparecendo mesmo com o Google certo, ou o contrÃ¡rio.

âœ… Corrija para a env do Google (exemplo):

const GOOGLE_CLIENT_ID = import.meta.env.VITE_GOOGLE_CLIENT_ID || "";
const GOOGLE_API_KEY = import.meta.env.VITE_GOOGLE_API_KEY || ""; // <- correto
const isGoogleConfigured = !!GOOGLE_CLIENT_ID && !!GOOGLE_API_KEY;
Se no seu projeto o nome da env for outro (ex: VITE_GOOGLE_API_KEY_BROWSER), use esse. Mas nÃ£o pode ser a do Gemini.

3) Bug 2 (browser): NodeJS.Timeout no React/Vite
No ProfessionalEditor:

const inactivityTimerRef = useRef<NodeJS.Timeout | null>(null);
Em app web (Vite), isso dÃ¡ ruÃ­do de types (depende da config TS). Melhor:

const inactivityTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);
4) Patch de layout (resolve o â€œscroll fininhoâ€ dos seus prints)
âœ… Troque o DialogContent do MinutasManager por um â€œlayout 3 blocosâ€
ANTES (vocÃª):

<DialogContent className="max-w-6xl max-h-[95vh] overflow-y-auto flex flex-col bg-card">
DEPOIS (recomendado):

<DialogContent className="max-w-6xl w-[min(96vw,72rem)] h-[90vh] p-0 flex flex-col bg-card overflow-hidden">
  {/* Header fixo */}
  <div className="p-6 border-b">
    <DialogHeader>
      ...
    </DialogHeader>

    <TabsList className="mt-4 grid w-full grid-cols-3">
      <TabsTrigger value="editor">Editor</TabsTrigger>
      <TabsTrigger value="templates">Templates</TabsTrigger>
      <TabsTrigger value="variaveis">VariÃ¡veis</TabsTrigger>
    </TabsList>
  </div>

  {/* Corpo: ÃšNICO lugar que rola */}
  <div className="flex-1 min-h-0 overflow-y-auto p-6">
    <Tabs value={activeTab} onValueChange={setActiveTab} className="h-full">
      <TabsContent value="editor" className="mt-0 h-full space-y-4">
        ...
        <div className="min-h-[420px]">
          <ProfessionalEditor ... className="h-full min-h-[420px]" />
        </div>
        ...
      </TabsContent>

      <TabsContent value="templates" className="mt-0">
        ...
      </TabsContent>

      <TabsContent value="variaveis" className="mt-0">
        ...
      </TabsContent>
    </Tabs>
  </div>

  {/* Footer fixo */}
  <div className="p-6 border-t flex justify-end gap-2">
    ...
  </div>
</DialogContent>
O que isso faz?
Remove scroll do modal (overflow-hidden)

Cria um Ãºnico scroll no miolo (flex-1 min-h-0 overflow-y-auto)

Header e Footer param de â€œsumirâ€ quando rola

Seu editor ganha Ã¡rea estÃ¡vel

ğŸ“Œ Regra de ouro: em layout flex vertical com scroll, sempre use min-h-0 no container que segura o scroll.

5) CorreÃ§Ã£o importante no streaming do CKEditor (vai te dar bugs intermitentes)
No streaming:

const viewFragment = editor.data.processor.toView(chunk);
const modelFragment = editor.data.toModel(viewFragment);
editor.model.insertContent(modelFragment);
âš ï¸ Isso quebra quando chunk vem â€œpicadoâ€ (ex: metade de uma tag, ou texto sem HTML vÃ¡lido).

âœ… Jeito robusto: inserir como texto (sem tentar parsear HTML em cada chunk):

editor.model.change((writer) => {
  const insertPosition = editor.model.document.selection.getFirstPosition();
  writer.insertText(chunk, insertPosition || editor.model.document.selection.getLastPosition()!);
});
Ou (melhor ainda) acumular chunk e aplicar a cada X ms (buffer), mas o â€œinsertTextâ€ jÃ¡ resolve 80% das dores.

6) Quais arquivos vocÃª deve colar aqui (pra eu corrigir 100% sem chute)
Como vocÃª quer deixar isso â€œredondoâ€ igual PJe/Google Docs, os arquivos mÃ­nimos pra eu fechar o diagnÃ³stico completo sÃ£o:

src/pages/MinutasManager.tsx (vocÃª jÃ¡ colou âœ…)

src/components/editor/ProfessionalEditor.tsx (vocÃª jÃ¡ colou âœ…)

src/components/editor/professional-editor.scss (esse Ã© MUITO importante pro layout A4/toolbar)

src/components/ui/dialog.tsx (ou onde estÃ¡ o wrapper do shadcn Dialog)

src/components/ui/scroll-area.tsx (Ã s vezes o scroll-area estÃ¡ com CSS que forÃ§a altura errada)

Hooks/serviÃ§os usados no fluxo:

src/hooks/use-google-docs.ts

src/lib/google-docs-service.ts

src/hooks/use-ai-commands.ts

src/hooks/use-ai-streaming.ts

src/hooks/use-editor-ai.ts

Com esses 6â€“8 arquivos eu consigo te devolver tudo pronto pra colar, jÃ¡ padronizado com 1 scroll, sem regressÃ£o.

Nota rÃ¡pida sobre o arquivo â€œexpiradoâ€
A plataforma avisou que alguns arquivos enviados antes expiraram. O que vocÃª colou aqui no chat estÃ¡ ok (isso nÃ£o expira), mas se vocÃª quiser que eu leia aquele arquivo que apareceu como upload (# ğŸ“‹ AnÃ¡lise Completa - Assistente JurÃ­d.ts), vocÃª vai precisar enviar de novo.

Se vocÃª jÃ¡ quiser, pode colar agora o professional-editor.scss e o ui/dialog.tsx â€” sÃ£o os dois que normalmente causam exatamente essa barra de rolagem interna dos prints.

VocÃª disse:
/**
 * Professional Editor - Estilo adaptativo para modal
 * Corrige problemas de toolbar flutuante do CKEditor 5
 */

/* Container Principal */
.professional-editor-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 400px;
  background: hsl(var(--background));
  border-radius: var(--radius);
  border: 1px solid hsl(var(--border));
  position: relative;
  overflow: hidden;
}

/* AI Toolbar */
.ai-toolbar {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  border-bottom: 1px solid hsl(var(--border));
  background: hsl(var(--muted) / 0.3);
  min-height: 48px;
  flex-shrink: 0;
  z-index: 10;
}

/* Editor Container - wrapper do CKEditor */
.professional-editor-page {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: white;
  position: relative;
  overflow: hidden;
  min-height: 0;
}

/* ============================================
   CKEditor 5 Overrides - FORÃ‡ANDO LAYOUT
   ============================================ */

/* Reset de todos os containers CK */
.professional-editor-page .ck-reset_all,
.professional-editor-page .ck.ck-reset {
  position: relative !important;
  display: flex !important;
  flex-direction: column !important;
  height: 100% !important;
  width: 100% !important;
}

/* Container principal do editor */
.professional-editor-page .ck.ck-editor {
  display: flex !important;
  flex-direction: column !important;
  flex: 1 !important;
  width: 100% !important;
  height: 100% !important;
  min-height: 300px !important;
  background: white !important;
  border: none !important;
  overflow: hidden !important;
  position: relative !important;
}

/* SeÃ§Ã£o superior do editor (contÃ©m toolbar) */
.professional-editor-page .ck.ck-editor__top {
  position: relative !important;
  z-index: 5 !important;
  flex-shrink: 0 !important;
  background: hsl(var(--muted) / 0.3) !important;
  border-bottom: 1px solid hsl(var(--border)) !important;
  width: 100% !important;
}

/* Sticky Panel - DESABILITAR comportamento sticky */
.professional-editor-page .ck.ck-sticky-panel {
  position: relative !important;
  width: 100% !important;
}

.professional-editor-page .ck.ck-sticky-panel__placeholder {
  display: none !important;
}

.professional-editor-page .ck.ck-sticky-panel__content {
  position: relative !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  margin: 0 !important;
  box-shadow: none !important;
  background: transparent !important;
}

.professional-editor-page .ck.ck-sticky-panel__content_sticky {
  position: relative !important;
  top: 0 !important;
  width: 100% !important;
  box-shadow: none !important;
}

/* Toolbar do CKEditor */
.professional-editor-page .ck.ck-toolbar {
  background: hsl(var(--muted) / 0.5) !important;
  border: none !important;
  border-radius: 0 !important;
  padding: 0.375rem 0.5rem !important;
  flex-wrap: wrap !important;
  width: 100% !important;
}

.professional-editor-page .ck.ck-toolbar__items {
  gap: 0.125rem !important;
  flex-wrap: wrap !important;
}

/* BotÃµes da toolbar */
.professional-editor-page .ck.ck-button,
.professional-editor-page .ck.ck-button.ck-off {
  border-radius: var(--radius) !important;
  padding: 0.25rem !important;
  min-width: 28px !important;
  min-height: 28px !important;
  border: none !important;
  background: transparent !important;
}

.professional-editor-page .ck.ck-button:hover {
  background: hsl(var(--muted)) !important;
}

.professional-editor-page .ck.ck-button.ck-on {
  background: hsl(var(--primary) / 0.15) !important;
  color: hsl(var(--primary)) !important;
}

/* Toolbar separator */
.professional-editor-page .ck.ck-toolbar__separator {
  background: hsl(var(--border)) !important;
  margin: 0 0.25rem !important;
}

/* Dropdowns do CKEditor */
.professional-editor-page .ck.ck-dropdown__button {
  border: none !important;
  background: transparent !important;
}

.professional-editor-page .ck.ck-dropdown__panel {
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1) !important;
  z-index: 9999 !important;
}

/* ============================================
   Color Picker / Font Color Panels (GLOBAL)
   ============================================ */

/* Os painÃ©is de cor sÃ£o renderizados no body, nÃ£o dentro do editor */
.ck.ck-color-ui-dropdown,
.ck.ck-color-picker,
.ck.ck-color-grid,
.ck.ck-color-table-dropdown {
  z-index: 99999 !important;
}

.ck.ck-dropdown__panel.ck-color-ui-dropdown__panel,
.ck.ck-dropdown__panel[class*="color"] {
  z-index: 99999 !important;
  background: white !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
  box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.15) !important;
}

/* Grid de cores */
.ck.ck-color-grid {
  padding: 0.5rem !important;
}

.ck.ck-color-grid__tile {
  width: 24px !important;
  height: 24px !important;
  border-radius: 4px !important;
  border: 1px solid transparent !important;
}

.ck.ck-color-grid__tile:hover {
  border-color: hsl(var(--primary)) !important;
  transform: scale(1.1);
}

/* Input de cor customizada */
.ck.ck-input-color input {
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
}

/* BotÃµes de cor na toolbar */
.professional-editor-page .ck.ck-font-color-dropdown,
.professional-editor-page .ck.ck-font-background-color-dropdown {
  position: relative !important;
}

.professional-editor-page .ck.ck-splitbutton {
  border: none !important;
}

.professional-editor-page .ck.ck-splitbutton__action,
.professional-editor-page .ck.ck-splitbutton__arrow {
  border: none !important;
  background: transparent !important;
}

.professional-editor-page .ck.ck-splitbutton:hover .ck-splitbutton__action,
.professional-editor-page .ck.ck-splitbutton:hover .ck-splitbutton__arrow {
  background: hsl(var(--muted)) !important;
}

/* Ãrea principal de conteÃºdo */
.professional-editor-page .ck.ck-editor__main {
  flex: 1 !important;
  overflow: hidden !important;
  position: relative !important;
  display: flex !important;
  flex-direction: column !important;
  min-height: 200px !important;
}

/* Ãrea editÃ¡vel */
.professional-editor-page .ck.ck-editor__editable,
.professional-editor-page .ck-editor__editable.ck-focused,
.professional-editor-page .ck.ck-editor__editable_inline {
  flex: 1 !important;
  padding: 1rem 1.5rem !important;
  min-height: 200px !important;
  overflow-y: auto !important;
  font-family: 'Times New Roman', Times, Georgia, serif !important;
  font-size: 14px !important;
  line-height: 1.6 !important;
  color: #1a1a1a !important;
  background: white !important;
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}

.professional-editor-page .ck.ck-editor__editable:focus,
.professional-editor-page .ck.ck-editor__editable.ck-focused {
  outline: none !important;
  box-shadow: none !important;
  border: none !important;
}

/* Placeholder */
.professional-editor-page .ck.ck-placeholder::before,
.professional-editor-page .ck-placeholder::before {
  color: hsl(var(--muted-foreground)) !important;
  font-style: italic !important;
}

/* ============================================
   Tipografia do conteÃºdo
   ============================================ */

.professional-editor-page .ck-content h1 {
  font-size: 1.75rem;
  font-weight: bold;
  margin: 1rem 0 0.75rem 0;
  line-height: 1.2;
}

.professional-editor-page .ck-content h2 {
  font-size: 1.5rem;
  font-weight: bold;
  margin: 0.875rem 0 0.5rem 0;
  line-height: 1.3;
}

.professional-editor-page .ck-content h3 {
  font-size: 1.25rem;
  font-weight: bold;
  margin: 0.75rem 0 0.5rem 0;
  line-height: 1.3;
}

.professional-editor-page .ck-content h4 {
  font-size: 1rem;
  font-weight: bold;
  margin: 0.625rem 0 0.375rem 0;
  line-height: 1.3;
}

.professional-editor-page .ck-content p {
  margin: 0 0 0.75rem 0;
  text-align: justify;
}

.professional-editor-page .ck-content ul,
.professional-editor-page .ck-content ol {
  margin: 0.75rem 0;
  padding-left: 1.5rem;
}

.professional-editor-page .ck-content li {
  margin: 0.25rem 0;
}

.professional-editor-page .ck-content blockquote {
  border-left: 3px solid hsl(var(--primary));
  padding-left: 1rem;
  margin: 1rem 0;
  font-style: italic;
  color: hsl(var(--muted-foreground));
}

/* Tabelas */
.professional-editor-page .ck-content table {
  width: 100%;
  border-collapse: collapse;
  margin: 1rem 0;
}

.professional-editor-page .ck-content th,
.professional-editor-page .ck-content td {
  border: 1px solid hsl(var(--border));
  padding: 0.5rem;
  text-align: left;
}

.professional-editor-page .ck-content th {
  background: hsl(var(--muted) / 0.5);
  font-weight: 600;
}

/* Footer */
.professional-editor-footer {
  padding: 0.5rem 0.75rem;
  border-top: 1px solid hsl(var(--border));
  background: hsl(var(--muted) / 0.3);
  flex-shrink: 0;
}

/* ============================================
   Balloon Toolbar (seleÃ§Ã£o de texto)
   ============================================ */

.ck.ck-balloon-panel {
  z-index: 9999 !important;
}

/* ===== =======================================
   Responsivo
   ============================================ */

@media (max-width: 768px) {
  .professional-editor-page .ck-editor__editable {
    padding: 0.75rem 1rem !important;
    font-size: 13px !important;
  }

  .ai-toolbar {
    padding: 0.375rem 0.5rem;
  }

  .professional-editor-page .ck.ck-toolbar {
    padding: 0.25rem !important;
  }
}                                import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};
import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};
 import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};   import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};


function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};  import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};  import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );   import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";
import { X } from "lucide-react";

function Dialog({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};




O ChatGPT disse:

Pensou por 1m 35s
VocÃª misturou SCSS + TypeScript no mesmo arquivo e ainda colou o dialog.tsx vÃ¡rias vezes dentro dele ğŸ˜…
Resultado: build quebrando, CSS â€œengolindoâ€ cÃ³digo, e o toolbar do CKEditor ficando maluco (especialmente dentro de Dialog do Radix por causa de transform + sticky toolbar).

Abaixo vai a correÃ§Ã£o pronta pra colar (separando certinho por arquivo) + um ajuste de CSS que resolve o toolbar flutuando no meio dentro do modal.

1) src/components/professional-editor/professional-editor.scss (APENAS SCSS)
Cole sÃ³ isso no seu SCSS. (Nada de TS aqui.)

/**
 * Professional Editor - Estilo adaptativo para modal
 * Corrige problemas de toolbar flutuante do CKEditor 5 dentro de Radix Dialog (transform + sticky)
 */

/* Container Principal */
.professional-editor-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 400px;
  background: hsl(var(--background));
  border-radius: var(--radius);
  border: 1px solid hsl(var(--border));
  position: relative;
  overflow: hidden;
}

/* AI Toolbar */
.ai-toolbar {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  border-bottom: 1px solid hsl(var(--border));
  background: hsl(var(--muted) / 0.3);
  min-height: 48px;
  flex-shrink: 0;
  z-index: 10;
}

/* Editor Container - wrapper do CKEditor */
.professional-editor-page {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: white;
  position: relative;
  overflow: hidden;
  min-height: 0;
}

/* ============================================
   CKEditor 5 Overrides - FORÃ‡ANDO LAYOUT
   ============================================ */

/* Reset de containers CK */
.professional-editor-page .ck-reset_all,
.professional-editor-page .ck.ck-reset {
  position: relative !important;
  display: flex !important;
  flex-direction: column !important;
  height: 100% !important;
  width: 100% !important;
}

/* Container principal do editor */
.professional-editor-page .ck.ck-editor {
  display: flex !important;
  flex-direction: column !important;
  flex: 1 !important;
  width: 100% !important;
  height: 100% !important;
  min-height: 300px !important;
  background: white !important;
  border: none !important;
  overflow: hidden !important;
  position: relative !important;
}

/* SeÃ§Ã£o superior do editor (toolbar) */
.professional-editor-page .ck.ck-editor__top {
  position: relative !important;
  z-index: 5 !important;
  flex-shrink: 0 !important;
  background: hsl(var(--muted) / 0.3) !important;
  border-bottom: 1px solid hsl(var(--border)) !important;
  width: 100% !important;
}

/* ========= FIX PRINCIPAL =========
   Radix Dialog usa transform (translate) no Content.
   Isso quebra sticky/fixed do CKEditor e a toolbar pode â€œflutuar no meioâ€.
   EntÃ£o: DESABILITA sticky com forÃ§a bruta (inclusive quando ele tenta ficar fixed).
*/
.professional-editor-wrapper .ck.ck-sticky-panel,
.professional-editor-wrapper .ck.ck-sticky-panel__content,
.professional-editor-wrapper .ck.ck-sticky-panel__content_sticky {
  position: static !important;
  top: auto !important;
  left: auto !important;
  right: auto !important;
  transform: none !important;
  box-shadow: none !important;
}

/* Placeholder do sticky */
.professional-editor-wrapper .ck.ck-sticky-panel__placeholder {
  display: none !important;
}

/* Toolbar do CKEditor */
.professional-editor-page .ck.ck-toolbar {
  background: hsl(var(--muted) / 0.5) !important;
  border: none !important;
  border-radius: 0 !important;
  padding: 0.375rem 0.5rem !important;
  flex-wrap: wrap !important;
  width: 100% !important;
}

.professional-editor-page .ck.ck-toolbar__items {
  gap: 0.125rem !important;
  flex-wrap: wrap !important;
}

/* BotÃµes da toolbar */
.professional-editor-page .ck.ck-button,
.professional-editor-page .ck.ck-button.ck-off {
  border-radius: var(--radius) !important;
  padding: 0.25rem !important;
  min-width: 28px !important;
  min-height: 28px !important;
  border: none !important;
  background: transparent !important;
}

.professional-editor-page .ck.ck-button:hover {
  background: hsl(var(--muted)) !important;
}

.professional-editor-page .ck.ck-button.ck-on {
  background: hsl(var(--primary) / 0.15) !important;
  color: hsl(var(--primary)) !important;
}

/* Separator */
.professional-editor-page .ck.ck-toolbar__separator {
  background: hsl(var(--border)) !important;
  margin: 0 0.25rem !important;
}

/* Dropdowns */
.professional-editor-page .ck.ck-dropdown__button {
  border: none !important;
  background: transparent !important;
}

.professional-editor-page .ck.ck-dropdown__panel {
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1) !important;
  z-index: 99999 !important;
}

/* ============================================
   Color Picker / Font Color Panels (GLOBAL)
   ============================================ */

.ck.ck-color-ui-dropdown,
.ck.ck-color-picker,
.ck.ck-color-grid,
.ck.ck-color-table-dropdown {
  z-index: 999999 !important;
}

.ck.ck-dropdown__panel.ck-color-ui-dropdown__panel,
.ck.ck-dropdown__panel[class*="color"] {
  z-index: 999999 !important;
  background: white !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
  box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.15) !important;
}

.ck.ck-color-grid {
  padding: 0.5rem !important;
}

.ck.ck-color-grid__tile {
  width: 24px !important;
  height: 24px !important;
  border-radius: 4px !important;
  border: 1px solid transparent !important;
}

.ck.ck-color-grid__tile:hover {
  border-color: hsl(var(--primary)) !important;
  transform: scale(1.1);
}

.ck.ck-input-color input {
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
}

/* Ãrea principal */
.professional-editor-page .ck.ck-editor__main {
  flex: 1 !important;
  overflow: hidden !important;
  position: relative !important;
  display: flex !important;
  flex-direction: column !important;
  min-height: 200px !important;
}

/* Ãrea editÃ¡vel */
.professional-editor-page .ck.ck-editor__editable,
.professional-editor-page .ck-editor__editable.ck-focused,
.professional-editor-page .ck.ck-editor__editable_inline {
  flex: 1 !important;
  padding: 1rem 1.5rem !important;
  min-height: 200px !important;
  overflow-y: auto !important;
  font-family: "Times New Roman", Times, Georgia, serif !important;
  font-size: 14px !important;
  line-height: 1.6 !important;
  color: #1a1a1a !important;
  background: white !important;
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}

.professional-editor-page .ck.ck-editor__editable:focus,
.professional-editor-page .ck.ck-editor__editable.ck-focused {
  outline: none !important;
  box-shadow: none !important;
  border: none !important;
}

/* Placeholder */
.professional-editor-page .ck.ck-placeholder::before,
.professional-editor-page .ck-placeholder::before {
  color: hsl(var(--muted-foreground)) !important;
  font-style: italic !important;
}

/* Tipografia */
.professional-editor-page .ck-content h1 {
  font-size: 1.75rem;
  font-weight: bold;
  margin: 1rem 0 0.75rem 0;
  line-height: 1.2;
}

.professional-editor-page .ck-content h2 {
  font-size: 1.5rem;
  font-weight: bold;
  margin: 0.875rem 0 0.5rem 0;
  line-height: 1.3;
}

.professional-editor-page .ck-content h3 {
  font-size: 1.25rem;
  font-weight: bold;
  margin: 0.75rem 0 0.5rem 0;
  line-height: 1.3;
}

.professional-editor-page .ck-content h4 {
  font-size: 1rem;
  font-weight: bold;
  margin: 0.625rem 0 0.375rem 0;
  line-height: 1.3;
}

.professional-editor-page .ck-content p {
  margin: 0 0 0.75rem 0;
  text-align: justify;
}

.professional-editor-page .ck-content ul,
.professional-editor-page .ck-content ol {
  margin: 0.75rem 0;
  padding-left: 1.5rem;
}

.professional-editor-page .ck-content li {
  margin: 0.25rem 0;
}

.professional-editor-page .ck-content blockquote {
  border-left: 3px solid hsl(var(--primary));
  padding-left: 1rem;
  margin: 1rem 0;
  font-style: italic;
  color: hsl(var(--muted-foreground));
}

/* Tabelas */
.professional-editor-page .ck-content table {
  width: 100%;
  border-collapse: collapse;
  margin: 1rem 0;
}

.professional-editor-page .ck-content th,
.professional-editor-page .ck-content td {
  border: 1px solid hsl(var(--border));
  padding: 0.5rem;
  text-align: left;
}

.professional-editor-page .ck-content th {
  background: hsl(var(--muted) / 0.5);
  font-weight: 600;
}

/* Footer */
.professional-editor-footer {
  padding: 0.5rem 0.75rem;
  border-top: 1px solid hsl(var(--border));
  background: hsl(var(--muted) / 0.3);
  flex-shrink: 0;
}

/* Balloon Toolbar */
.ck.ck-balloon-panel {
  z-index: 999999 !important;
}

/* Responsivo */
@media (max-width: 768px) {
  .professional-editor-page .ck-editor__editable {
    padding: 0.75rem 1rem !important;
    font-size: 13px !important;
  }

  .ai-toolbar {
    padding: 0.375rem 0.5rem;
  }

  .professional-editor-page .ck.ck-toolbar {
    padding: 0.25rem !important;
  }
}
âœ… Esse â€œFIX PRINCIPALâ€ (desligar sticky com position: static !important) Ã© o que normalmente resolve o sintoma toolbar flutuando no meio dentro de Dialog do Radix.

2) src/components/ui/dialog.tsx (limpo, sem duplicatas)
VocÃª colou o mesmo arquivo muitas vezes. Deixa somente 1 versÃ£o:

import * as DialogPrimitive from "@radix-ui/react-dialog";
import { ComponentProps } from "react";
import { X } from "lucide-react";

import { cn } from "@/lib/utils";

function Dialog(props: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger(props: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal(props: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose(props: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

/**
 * Nota: manter overflow-hidden Ã© ok.
 * O CKEditor resolve dropdowns/balloons via body + z-index (jÃ¡ ajustado no SCSS).
 */
function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};
3) Por que a toolbar â€œflutuaâ€ no modal?
Porque o DialogContent do Radix usa transform: translate(...) pra centralizar.
O CKEditor, quando ativa sticky, tenta virar position: fixed e isso fica bugado dentro de um ancestor com transform â†’ a toolbar aparece em posiÃ§Ã£o errada (tipo no meio).

âœ… A soluÃ§Ã£o mais estÃ¡vel Ã©: desligar sticky via CSS (o trecho que eu coloquei no SCSS).

Se vocÃª colar exatamente esses dois arquivos (SCSS + dialog.tsx) do jeito acima, vocÃª vai eliminar:

toolbar do CKEditor flutuando no meio no modal

dropdowns/cores ficando atrÃ¡s de overlay (z-index)

erro de build por ter TypeScript dentro do .scss

duplicaÃ§Ã£o absurda do dialog.tsx que explode o bundle e dÃ¡ conflito de sÃ­mbolos

Quando vocÃª rodar de novo, seu editor vai se comportar â€œnormalâ€ dentro do modal, sem teleport estranho.

VocÃª disse:
import * as DialogPrimitive from "@radix-ui/react-dialog";
import { X } from "lucide-react";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";

function Dialog(props: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger(props: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal(props: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose(props: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

/**
 * Nota: manter overflow-hidden Ã© ok.
 * O CKEditor resolve dropdowns/balloons via body + z-index (jÃ¡ ajustado no SCSS).
 */
function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};
ğŸ“ Arquivos Localizados
1. professional-editor.scss
Caminho: professional-editor.scss
Linhas: 388 linhas
Tipo: SCSS (estilos para CKEditor 5)

Principais seÃ§Ãµes:

Container principal e AI toolbar
Overrides forÃ§ados do CKEditor 5 (toolbar sticky, layout)
Color picker panels (z-index global)
Ãrea editÃ¡vel e tipografia
Responsividade
Balloon toolbar
Problema tratado: Corrige toolbar flutuante do CKEditor 5 em modais

2. dialog.tsx
Caminho: dialog.tsx
Linhas: 118 linhas
Tipo: Componente React (Radix UI Dialog)

Componentes exportados:

Dialog - Root do modal
DialogTrigger - BotÃ£o que abre
DialogContent - ConteÃºdo do modal
DialogHeader - CabeÃ§alho
DialogFooter - RodapÃ©
DialogTitle - TÃ­tulo
DialogDescription - DescriÃ§Ã£o
DialogOverlay - Overlay de fundo
DialogClose - BotÃ£o fechar
Classes importantes:

max-w-[calc(100%-2rem)] - Largura mÃ¡xima responsiva
z-50 - Z-index do modal
Overlay com bg-black/50
O ChatGPT disse:

Pensou por 13s
Perfeito â€” o â€œbugâ€ aqui nÃ£o Ã© o CKEditor em si: Ã© CSS/posicionamento em modal + overflow e (no seu texto anterior) arquivo SCSS contaminado com TSX (vocÃª colou dialog.tsx dentro do .scss vÃ¡rias vezes).

Vou te deixar 2 coisas prontas:

dialog.tsx limpo (o seu jÃ¡ estÃ¡ Ã³timo; sÃ³ mantenho igual e com comentÃ¡rios).

professional-editor.scss limpo e seguro para modal, removendo qualquer â€œlixoâ€ de TSX e ajustando z-index/containers.

E vou te dar um patch importantÃ­ssimo: o seu menu flutuante de slash command (<div className="absolute ...">) vai ser CORTADO por causa de overflow: hidden no wrapper/modal. A correÃ§Ã£o â€œprofissionalâ€ Ã©: renderizar esse menu com position: fixed (ou Portal pro document.body).

1) dialog.tsx (pronto pra colar)
import * as DialogPrimitive from "@radix-ui/react-dialog";
import { X } from "lucide-react";
import { ComponentProps } from "react";

import { cn } from "@/lib/utils";

function Dialog(props: Readonly<ComponentProps<typeof DialogPrimitive.Root>>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger(props: ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal(props: Readonly<ComponentProps<typeof DialogPrimitive.Portal>>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose(props: ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  );
}

/**
 * Nota: manter overflow-hidden Ã© ok.
 * O CKEditor resolve dropdowns/balloons via body + z-index (jÃ¡ ajustado no SCSS).
 */
function DialogContent({
  className,
  children,
  ...props
}: ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        aria-describedby={undefined}
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <X />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};
2) professional-editor.scss (limpo, sÃ³ SCSS â€” pronto pra colar)
ObservaÃ§Ã£o: garanta que este arquivo NÃƒO tenha nenhum import/TSX embaixo. Ele deve terminar no Ãºltimo }.

/**
 * Professional Editor - Estilo adaptativo para modal
 * Corrige problemas de toolbar flutuante do CKEditor 5
 */

/* Container Principal */
.professional-editor-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 400px;
  background: hsl(var(--background));
  border-radius: var(--radius);
  border: 1px solid hsl(var(--border));
  position: relative;

  /* pode ficar hidden â€” mas lembre: qualquer coisa â€œflutuanteâ€ dentro
     (ex.: seu menu de slash) vai ser cortada */
  overflow: hidden;
}

/* AI Toolbar */
.ai-toolbar {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  border-bottom: 1px solid hsl(var(--border));
  background: hsl(var(--muted) / 0.3);
  min-height: 48px;
  flex-shrink: 0;
  z-index: 10;
}

/* Editor Container - wrapper do CKEditor */
.professional-editor-page {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: white;
  position: relative;
  overflow: hidden;
  min-height: 0;
}

/* ============================================
   CKEditor 5 Overrides - FORÃ‡ANDO LAYOUT
   ============================================ */

.professional-editor-page .ck-reset_all,
.professional-editor-page .ck.ck-reset {
  position: relative !important;
  display: flex !important;
  flex-direction: column !important;
  height: 100% !important;
  width: 100% !important;
}

/* Container principal do editor */
.professional-editor-page .ck.ck-editor {
  display: flex !important;
  flex-direction: column !important;
  flex: 1 !important;
  width: 100% !important;
  height: 100% !important;
  min-height: 300px !important;
  background: white !important;
  border: none !important;
  overflow: hidden !important;
  position: relative !important;
}

/* SeÃ§Ã£o superior do editor (contÃ©m toolbar) */
.professional-editor-page .ck.ck-editor__top {
  position: relative !important;
  z-index: 5 !important;
  flex-shrink: 0 !important;
  background: hsl(var(--muted) / 0.3) !important;
  border-bottom: 1px solid hsl(var(--border)) !important;
  width: 100% !important;
}

/* Sticky Panel - DESABILITAR comportamento sticky */
.professional-editor-page .ck.ck-sticky-panel {
  position: relative !important;
  width: 100% !important;
}

.professional-editor-page .ck.ck-sticky-panel__placeholder {
  display: none !important;
}

.professional-editor-page .ck.ck-sticky-panel__content {
  position: relative !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  margin: 0 !important;
  box-shadow: none !important;
  background: transparent !important;
}

.professional-editor-page .ck.ck-sticky-panel__content_sticky {
  position: relative !important;
  top: 0 !important;
  width: 100% !important;
  box-shadow: none !important;
}

/* Toolbar do CKEditor */
.professional-editor-page .ck.ck-toolbar {
  background: hsl(var(--muted) / 0.5) !important;
  border: none !important;
  border-radius: 0 !important;
  padding: 0.375rem 0.5rem !important;
  flex-wrap: wrap !important;
  width: 100% !important;
}

.professional-editor-page .ck.ck-toolbar__items {
  gap: 0.125rem !important;
  flex-wrap: wrap !important;
}

/* BotÃµes da toolbar */
.professional-editor-page .ck.ck-button,
.professional-editor-page .ck.ck-button.ck-off {
  border-radius: var(--radius) !important;
  padding: 0.25rem !important;
  min-width: 28px !important;
  min-height: 28px !important;
  border: none !important;
  background: transparent !important;
}

.professional-editor-page .ck.ck-button:hover {
  background: hsl(var(--muted)) !important;
}

.professional-editor-page .ck.ck-button.ck-on {
  background: hsl(var(--primary) / 0.15) !important;
  color: hsl(var(--primary)) !important;
}

/* Toolbar separator */
.professional-editor-page .ck.ck-toolbar__separator {
  background: hsl(var(--border)) !important;
  margin: 0 0.25rem !important;
}

/* Dropdowns do CKEditor */
.professional-editor-page .ck.ck-dropdown__button {
  border: none !important;
  background: transparent !important;
}

.professional-editor-page .ck.ck-dropdown__panel {
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1) !important;
  z-index: 99999 !important;
}

/* ============================================
   Color Picker / Font Color Panels (GLOBAL)
   (renderizados no body)
   ============================================ */
.ck.ck-color-ui-dropdown,
.ck.ck-color-picker,
.ck.ck-color-grid,
.ck.ck-color-table-dropdown {
  z-index: 999999 !important;
}

.ck.ck-dropdown__panel.ck-color-ui-dropdown__panel,
.ck.ck-dropdown__panel[class*="color"] {
  z-index: 999999 !important;
  background: white !important;
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
  box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.15) !important;
}

/* Grid de cores */
.ck.ck-color-grid {
  padding: 0.5rem !important;
}

.ck.ck-color-grid__tile {
  width: 24px !important;
  height: 24px !important;
  border-radius: 4px !important;
  border: 1px solid transparent !important;
}

.ck.ck-color-grid__tile:hover {
  border-color: hsl(var(--primary)) !important;
  transform: scale(1.1);
}

/* Input de cor customizada */
.ck.ck-input-color input {
  border: 1px solid hsl(var(--border)) !important;
  border-radius: var(--radius) !important;
}

/* Ãrea principal de conteÃºdo */
.professional-editor-page .ck.ck-editor__main {
  flex: 1 !important;
  overflow: hidden !important;
  position: relative !important;
  display: flex !important;
  flex-direction: column !important;
  min-height: 200px !important;
}

/* Ãrea editÃ¡vel */
.professional-editor-page .ck.ck-editor__editable,
.professional-editor-page .ck-editor__editable.ck-focused,
.professional-editor-page .ck.ck-editor__editable_inline {
  flex: 1 !important;
  padding: 1rem 1.5rem !important;
  min-height: 200px !important;
  overflow-y: auto !important;
  font-family: "Times New Roman", Times, Georgia, serif !important;
  font-size: 14px !important;
  line-height: 1.6 !important;
  color: #1a1a1a !important;
  background: white !important;
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}

.professional-editor-page .ck.ck-editor__editable:focus,
.professional-editor-page .ck.ck-editor__editable.ck-focused {
  outline: none !important;
  box-shadow: none !important;
  border: none !important;
}

/* Placeholder */
.professional-editor-page .ck.ck-placeholder::before,
.professional-editor-page .ck-placeholder::before {
  color: hsl(var(--muted-foreground)) !important;
  font-style: italic !important;
}

/* Tipografia do conteÃºdo */
.professional-editor-page .ck-content h1 {
  font-size: 1.75rem;
  font-weight: bold;
  margin: 1rem 0 0.75rem 0;
  line-height: 1.2;
}

.professional-editor-page .ck-content h2 {
  font-size: 1.5rem;
  font-weight: bold;
  margin: 0.875rem 0 0.5rem 0;
  line-height: 1.3;
}

.professional-editor-page .ck-content h3 {
  font-size: 1.25rem;
  font-weight: bold;
  margin: 0.75rem 0 0.5rem 0;
  line-height: 1.3;
}

.professional-editor-page .ck-content h4 {
  font-size: 1rem;
  font-weight: bold;
  margin: 0.625rem 0 0.375rem 0;
  line-height: 1.3;
}

.professional-editor-page .ck-content p {
  margin: 0 0 0.75rem 0;
  text-align: justify;
}

.professional-editor-page .ck-content ul,
.professional-editor-page .ck-content ol {
  margin: 0.75rem 0;
  padding-left: 1.5rem;
}

.professional-editor-page .ck-content li {
  margin: 0.25rem 0;
}

.professional-editor-page .ck-content blockquote {
  border-left: 3px solid hsl(var(--primary));
  padding-left: 1rem;
  margin: 1rem 0;
  font-style: italic;
  color: hsl(var(--muted-foreground));
}

/* Tabelas */
.professional-editor-page .ck-content table {
  width: 100%;
  border-collapse: collapse;
  margin: 1rem 0;
}

.professional-editor-page .ck-content th,
.professional-editor-page .ck-content td {
  border: 1px solid hsl(var(--border));
  padding: 0.5rem;
  text-align: left;
}

.professional-editor-page .ck-content th {
  background: hsl(var(--muted) / 0.5);
  font-weight: 600;
}

/* Footer */
.professional-editor-footer {
  padding: 0.5rem 0.75rem;
  border-top: 1px solid hsl(var(--border));
  background: hsl(var(--muted) / 0.3);
  flex-shrink: 0;
}

/* Balloon Toolbar */
.ck.ck-balloon-panel {
  z-index: 999999 !important;
}

/* Responsivo */
@media (max-width: 768px) {
  .professional-editor-page .ck-editor__editable {
    padding: 0.75rem 1rem !important;
    font-size: 13px !important;
  }

  .ai-toolbar {
    padding: 0.375rem 0.5rem;
  }

  .professional-editor-page .ck.ck-toolbar {
    padding: 0.25rem !important;
  }
}
3) Patch obrigatÃ³rio: seu menu â€œ/â€ (slash) vai ser cortado no modal
Hoje vocÃª renderiza assim:

<div className="absolute z-50 ..." style={{ top, left }} />
Mas seu wrapper tem overflow: hidden, entÃ£o esse menu pode ficar invisÃ­vel quando â€œencostarâ€ nas bordas.

SoluÃ§Ã£o simples e robusta: position: fixed (nÃ£o Ã© cortado por overflow)
Troque o render do menu para:

{showSlashMenu && filteredSlashCommands.length > 0 && (
  <div
    className="fixed z-[999999] bg-background border rounded-lg shadow-lg p-2 w-64"
    style={{ top: slashMenuPosition.top, left: slashMenuPosition.left }}
  >
    ...
  </div>
)}
E ajuste o cÃ¡lculo da posiÃ§Ã£o (remova window.scrollY/X), porque getBoundingClientRect() jÃ¡ estÃ¡ em coordenadas da viewport:

setSlashMenuPosition({
  top: rect.bottom + 5,
  left: rect.left,
});
âœ… Resultado: menu flutua acima do modal sem ser cortado, e o z-index garante que ele vence o z-50.

Nota rÃ¡pida sobre os arquivos que vocÃª â€œlocalizouâ€
Vi que vocÃª colou um trecho â€œğŸ“ Arquivos Localizadosâ€¦â€. Eu nÃ£o consigo reabrir alguns uploads anteriores porque alguns anexos expiram aqui no ambiente. Mas como vocÃª jÃ¡ colou o cÃ³digo inteiro no chat, dÃ¡ pra corrigir 100% por aqui.

Se vocÃª aplicar esse patch do menu â€œ/â€ com fixed, somado ao SCSS limpo, vocÃª mata 95% dos problemas clÃ¡ssicos de CKEditor dentro de modal (toolbar, dropdowns, color picker, balloon e menus flutuantes).
